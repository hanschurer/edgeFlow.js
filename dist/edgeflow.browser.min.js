var Ut=Object.defineProperty;var ts=(o,t,e)=>t in o?Ut(o,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):o[t]=e;var rt=(o,t)=>()=>(o&&(t=o(o=0)),t);var ns=(o,t)=>{for(var e in t)Ut(o,e,{get:t[e],enumerable:!0})};var f=(o,t,e)=>(ts(o,typeof t!="symbol"?t+"":t,e),e);var x,M,C=rt(()=>{"use strict";x=class extends Error{constructor(e,n,s){super(e);f(this,"code");f(this,"details");this.code=n,this.details=s,this.name="EdgeFlowError"}},M={RUNTIME_NOT_AVAILABLE:"RUNTIME_NOT_AVAILABLE",RUNTIME_INIT_FAILED:"RUNTIME_INIT_FAILED",RUNTIME_NOT_INITIALIZED:"RUNTIME_NOT_INITIALIZED",MODEL_NOT_FOUND:"MODEL_NOT_FOUND",MODEL_LOAD_FAILED:"MODEL_LOAD_FAILED",MODEL_INVALID_FORMAT:"MODEL_INVALID_FORMAT",MODEL_NOT_LOADED:"MODEL_NOT_LOADED",INFERENCE_FAILED:"INFERENCE_FAILED",INFERENCE_TIMEOUT:"INFERENCE_TIMEOUT",INFERENCE_CANCELLED:"INFERENCE_CANCELLED",OUT_OF_MEMORY:"OUT_OF_MEMORY",MEMORY_LEAK_DETECTED:"MEMORY_LEAK_DETECTED",TENSOR_SHAPE_MISMATCH:"TENSOR_SHAPE_MISMATCH",TENSOR_DTYPE_MISMATCH:"TENSOR_DTYPE_MISMATCH",TENSOR_DISPOSED:"TENSOR_DISPOSED",PIPELINE_NOT_SUPPORTED:"PIPELINE_NOT_SUPPORTED",PIPELINE_INPUT_INVALID:"PIPELINE_INPUT_INVALID",INVALID_ARGUMENT:"INVALID_ARGUMENT",NOT_IMPLEMENTED:"NOT_IMPLEMENTED",UNKNOWN_ERROR:"UNKNOWN_ERROR"}});function rs(){return`tensor_${++ss}_${Date.now().toString(36)}`}function Pe(o){switch(o){case"float32":return Float32Array;case"float16":return Float32Array;case"int32":return Int32Array;case"int64":return BigInt64Array;case"uint8":case"bool":return Uint8Array;case"int8":return Int8Array;default:throw new x(`Unsupported data type: ${o}`,M.INVALID_ARGUMENT,{dtype:o})}}function te(o){return o.length===0?1:o.reduce((t,e)=>t*e,1)}function os(o){for(let t=0;t<o.length;t++){let e=o[t];if(e===void 0||!Number.isInteger(e)||e<0)throw new x(`Invalid shape dimension at index ${t}: ${e}`,M.INVALID_ARGUMENT,{shape:o,index:t,dimension:e})}}function qt(o,t,e="float32"){if(Array.isArray(o)&&o.length>0&&Array.isArray(o[0])){let s=o.length,i=o[0].length,r=[];for(let a of o){if(a.length!==i)throw new x("Nested arrays must have consistent dimensions",M.INVALID_ARGUMENT);r.push(...a)}return new g(r,t??[s,i],e)}let n=t??[o.length];return new g(o,n,e)}function ot(o,t="float32"){let e=te(o),n=Pe(t),s=new n(e);return new g(s,o,t)}function jt(o,t="float32"){let e=te(o),n=Pe(t),s=new n(e);return s.fill(1),new g(s,o,t)}function Wt(o,t,e="float32"){let n=te(o),s=Pe(e),i=new s(n);return i.fill(t),new g(i,o,e)}function Ht(o,t="float32"){let e=te(o),n=new Float32Array(e);for(let s=0;s<e;s++)n[s]=Math.random();return new g(n,o,t)}function Vt(o,t="float32"){let e=te(o),n=new Float32Array(e);for(let s=0;s<e;s+=2){let i=Math.random(),r=Math.random(),a=Math.sqrt(-2*Math.log(i)),c=2*Math.PI*r;n[s]=a*Math.cos(c),s+1<e&&(n[s+1]=a*Math.sin(c))}return new g(n,o,t)}function Gt(o,t,e=1,n="float32"){t===void 0&&(t=o,o=0);let s=Math.ceil((t-o)/e),i=new Float32Array(s);for(let r=0;r<s;r++)i[r]=o+r*e;return new g(i,[s],n)}function Xt(o,t,e=50,n="float32"){let s=new Float32Array(e),i=(t-o)/(e-1);for(let r=0;r<e;r++)s[r]=o+r*i;return new g(s,[e],n)}function Qt(o,t="float32"){let e=new Float32Array(o*o);for(let n=0;n<o;n++)e[n*o+n]=1;return new g(e,[o,o],t)}function Kt(o,t){if(typeof t=="number"){let i=new Float32Array(o.size),r=o.toFloat32Array();for(let a=0;a<o.size;a++)i[a]=(r[a]??0)+t;return new g(i,o.shape,o.dtype)}if(o.size!==t.size)throw new x("Tensor sizes must match for element-wise operations",M.TENSOR_SHAPE_MISMATCH,{aShape:o.shape,bShape:t.shape});let e=new Float32Array(o.size),n=o.toFloat32Array(),s=t.toFloat32Array();for(let i=0;i<o.size;i++)e[i]=(n[i]??0)+(s[i]??0);return new g(e,o.shape,o.dtype)}function Jt(o,t){if(typeof t=="number"){let i=new Float32Array(o.size),r=o.toFloat32Array();for(let a=0;a<o.size;a++)i[a]=(r[a]??0)-t;return new g(i,o.shape,o.dtype)}if(o.size!==t.size)throw new x("Tensor sizes must match for element-wise operations",M.TENSOR_SHAPE_MISMATCH,{aShape:o.shape,bShape:t.shape});let e=new Float32Array(o.size),n=o.toFloat32Array(),s=t.toFloat32Array();for(let i=0;i<o.size;i++)e[i]=(n[i]??0)-(s[i]??0);return new g(e,o.shape,o.dtype)}function Yt(o,t){if(typeof t=="number"){let i=new Float32Array(o.size),r=o.toFloat32Array();for(let a=0;a<o.size;a++)i[a]=(r[a]??0)*t;return new g(i,o.shape,o.dtype)}if(o.size!==t.size)throw new x("Tensor sizes must match for element-wise operations",M.TENSOR_SHAPE_MISMATCH,{aShape:o.shape,bShape:t.shape});let e=new Float32Array(o.size),n=o.toFloat32Array(),s=t.toFloat32Array();for(let i=0;i<o.size;i++)e[i]=(n[i]??0)*(s[i]??0);return new g(e,o.shape,o.dtype)}function it(o,t){if(typeof t=="number"){let i=new Float32Array(o.size),r=o.toFloat32Array();for(let a=0;a<o.size;a++)i[a]=(r[a]??0)/t;return new g(i,o.shape,o.dtype)}if(o.size!==t.size)throw new x("Tensor sizes must match for element-wise operations",M.TENSOR_SHAPE_MISMATCH,{aShape:o.shape,bShape:t.shape});let e=new Float32Array(o.size),n=o.toFloat32Array(),s=t.toFloat32Array();for(let i=0;i<o.size;i++)e[i]=(n[i]??0)/(s[i]??0);return new g(e,o.shape,o.dtype)}function Zt(o,t){if(o.shape.length!==2||t.shape.length!==2)throw new x("matmul requires 2D tensors",M.INVALID_ARGUMENT,{aShape:o.shape,bShape:t.shape});let[e,n]=o.shape,[s,i]=t.shape;if(n!==s)throw new x(`Matrix dimensions incompatible for multiplication: (${e}x${n}) @ (${s}x${i})`,M.TENSOR_SHAPE_MISMATCH,{aShape:o.shape,bShape:t.shape});let r=new Float32Array(e*i),a=o.toFloat32Array(),c=t.toFloat32Array();for(let l=0;l<e;l++)for(let u=0;u<i;u++){let d=0;for(let h=0;h<n;h++)d+=(a[l*n+h]??0)*(c[h*i+u]??0);r[l*i+u]=d}return new g(r,[e,i],o.dtype)}function L(o,t=-1){let e=o.toFloat32Array(),n=new Float32Array(o.size),s=t<0?o.shape.length+t:t;if(s<0||s>=o.shape.length)throw new x(`Invalid axis ${t} for tensor with ${o.shape.length} dimensions`,M.INVALID_ARGUMENT,{axis:t,shape:o.shape});if(o.shape.length===1){let i=-1/0;for(let a=0;a<o.size;a++)(e[a]??0)>i&&(i=e[a]??0);let r=0;for(let a=0;a<o.size;a++)n[a]=Math.exp((e[a]??0)-i),r+=n[a]??0;for(let a=0;a<o.size;a++)n[a]=(n[a]??0)/r;return new g(n,o.shape,o.dtype)}if(o.shape.length===2&&s===1){let[i,r]=o.shape;for(let a=0;a<i;a++){let c=-1/0;for(let u=0;u<r;u++)(e[a*r+u]??0)>c&&(c=e[a*r+u]??0);let l=0;for(let u=0;u<r;u++)n[a*r+u]=Math.exp((e[a*r+u]??0)-c),l+=n[a*r+u]??0;for(let u=0;u<r;u++)n[a*r+u]=(n[a*r+u]??0)/l}return new g(n,o.shape,o.dtype)}throw new x("Softmax currently only supports 1D tensors or 2D tensors along the last axis",M.NOT_IMPLEMENTED,{shape:o.shape,axis:t})}function De(o){let t=o.toFloat32Array(),e=new Float32Array(o.size);for(let n=0;n<o.size;n++)e[n]=Math.max(0,t[n]??0);return new g(e,o.shape,o.dtype)}function Le(o){let t=o.toFloat32Array(),e=new Float32Array(o.size);for(let n=0;n<o.size;n++)e[n]=1/(1+Math.exp(-(t[n]??0)));return new g(e,o.shape,o.dtype)}function en(o){let t=o.toFloat32Array(),e=new Float32Array(o.size);for(let n=0;n<o.size;n++)e[n]=Math.tanh(t[n]??0);return new g(e,o.shape,o.dtype)}function Fe(o,t){let e=o.toFloat32Array();if(t===void 0){let i=0;for(let r=0;r<o.size;r++)i+=e[r]??0;return i}let n=t<0?o.shape.length+t:t;if(n<0||n>=o.shape.length)throw new x(`Invalid axis ${t} for tensor with ${o.shape.length} dimensions`,M.INVALID_ARGUMENT,{axis:t,shape:o.shape});let s=[...o.shape];if(s.splice(n,1),s.length===0){let i=0;for(let r=0;r<o.size;r++)i+=e[r]??0;return i}if(o.shape.length===2){let[i,r]=o.shape;if(n===0){let a=new Float32Array(r);for(let c=0;c<r;c++)for(let l=0;l<i;l++)a[c]=(a[c]??0)+(e[l*r+c]??0);return new g(a,[r],o.dtype)}else{let a=new Float32Array(i);for(let c=0;c<i;c++)for(let l=0;l<r;l++)a[c]=(a[c]??0)+(e[c*r+l]??0);return new g(a,[i],o.dtype)}}throw new x("Sum along axis currently only supports up to 2D tensors",M.NOT_IMPLEMENTED,{shape:o.shape,axis:t})}function tn(o,t){if(t===void 0)return Fe(o)/o.size;let e=Fe(o,t);if(typeof e=="number")return e/(o.shape[t]??1);let n=o.shape[t]??1;return it(e,n)}function nn(o,t){let e=o.toFloat32Array();if(t===void 0){let s=0,i=e[0]??-1/0;for(let r=1;r<o.size;r++)(e[r]??-1/0)>i&&(i=e[r]??-1/0,s=r);return s}let n=t<0?o.shape.length+t:t;if(o.shape.length===2&&n===1){let[s,i]=o.shape,r=new Float32Array(s);for(let a=0;a<s;a++){let c=0,l=e[a*i]??-1/0;for(let u=1;u<i;u++)(e[a*i+u]??-1/0)>l&&(l=e[a*i+u]??-1/0,c=u);r[a]=c}return new g(r,[s],"int32")}throw new x("Argmax along axis currently only supports 2D tensors along the last axis",M.NOT_IMPLEMENTED,{shape:o.shape,axis:t})}function sn(o,t=0){if(o.length===0)throw new x("Cannot concatenate empty array of tensors",M.INVALID_ARGUMENT);if(o.length===1)return o[0]?.clone()??ot([0]);let e=o[0];if(!e)throw new x("First tensor is undefined",M.INVALID_ARGUMENT);let n=t<0?e.shape.length+t:t;for(let r=1;r<o.length;r++){let a=o[r];if(a){if(a.shape.length!==e.shape.length)throw new x("All tensors must have the same number of dimensions",M.TENSOR_SHAPE_MISMATCH);for(let c=0;c<e.shape.length;c++)if(c!==n&&e.shape[c]!==a.shape[c])throw new x(`Shape mismatch at dimension ${c}`,M.TENSOR_SHAPE_MISMATCH)}}let s=[...e.shape],i=0;for(let r of o)r&&(i+=r.shape[n]??0);if(s[n]=i,e.shape.length===1){let r=new Float32Array(i),a=0;for(let c of o)c&&(r.set(c.toFloat32Array(),a),a+=c.size);return new g(r,s,e.dtype)}throw new x("Concatenation currently only supports 1D tensors",M.NOT_IMPLEMENTED)}var ss,g,F=rt(()=>{"use strict";C();ss=0;g=class o{constructor(t,e,n="float32"){f(this,"id");f(this,"dtype");f(this,"shape");f(this,"size");f(this,"_data");f(this,"_isDisposed",!1);os(e),this.id=rs(),this.dtype=n,this.shape=Object.freeze([...e]),this.size=te(this.shape);let s=this.size;if(t.length!==s)throw new x(`Data length (${t.length}) does not match shape ${JSON.stringify(e)} (expected ${s})`,M.TENSOR_SHAPE_MISMATCH,{dataLength:t.length,expectedSize:s,shape:e});if(t instanceof Array){let i=Pe(n);if(this._data=new i(t.length),n==="int64"){let r=this._data;for(let a=0;a<t.length;a++)r[a]=BigInt(Math.round(t[a]??0))}else for(let r=0;r<t.length;r++)this._data[r]=t[r]??0}else this._data=t}get data(){return this.checkDisposed(),this._data}get isDisposed(){return this._isDisposed}checkDisposed(){if(this._isDisposed)throw new x("Cannot access disposed tensor",M.TENSOR_DISPOSED,{tensorId:this.id})}toFloat32Array(){if(this.checkDisposed(),this._data instanceof Float32Array)return this._data;let t=new Float32Array(this.size);for(let e=0;e<this.size;e++)t[e]=Number(this._data[e]??0);return t}toArray(){if(this.checkDisposed(),this.dtype==="int64"){let t=this._data,e=[];for(let n=0;n<t.length;n++)e.push(Number(t[n]));return e}return Array.from(this._data)}clone(){this.checkDisposed();let t=this._data.constructor,e=new t(this._data);return new o(e,this.shape,this.dtype)}dispose(){this._isDisposed||(this._isDisposed=!0,Object.assign(this,{_data:null}))}get(...t){if(this.checkDisposed(),t.length!==this.shape.length)throw new x(`Expected ${this.shape.length} indices, got ${t.length}`,M.INVALID_ARGUMENT,{expectedIndices:this.shape.length,gotIndices:t.length});let e=0,n=1;for(let s=this.shape.length-1;s>=0;s--){let i=t[s]??0,r=this.shape[s]??1;if(i<0||i>=r)throw new x(`Index ${i} out of bounds for dimension ${s} with size ${r}`,M.INVALID_ARGUMENT,{index:i,dimension:s,size:r});e+=i*n,n*=r}return Number(this._data[e]??0)}set(t,...e){if(this.checkDisposed(),e.length!==this.shape.length)throw new x(`Expected ${this.shape.length} indices, got ${e.length}`,M.INVALID_ARGUMENT,{expectedIndices:this.shape.length,gotIndices:e.length});let n=0,s=1;for(let i=this.shape.length-1;i>=0;i--){let r=e[i]??0,a=this.shape[i]??1;if(r<0||r>=a)throw new x(`Index ${r} out of bounds for dimension ${i} with size ${a}`,M.INVALID_ARGUMENT,{index:r,dimension:i,size:a});n+=r*s,s*=a}this._data[n]=t}reshape(t){this.checkDisposed();let e=te(t);if(e!==this.size)throw new x(`Cannot reshape tensor of size ${this.size} to shape ${JSON.stringify(t)} (size ${e})`,M.TENSOR_SHAPE_MISMATCH,{currentSize:this.size,newSize:e,newShape:t});let n=this._data.constructor,s=new n(this._data);return new o(s,t,this.dtype)}transpose(){if(this.checkDisposed(),this.shape.length!==2)throw new x("Transpose is currently only supported for 2D tensors",M.NOT_IMPLEMENTED,{shape:this.shape});let[t,e]=this.shape,n=new Float32Array(this.size);for(let s=0;s<t;s++)for(let i=0;i<e;i++)n[i*t+s]=Number(this._data[s*e+i]??0);return new o(n,[e,t],this.dtype)}toString(){return`Tensor(shape=[${this.shape.join(", ")}], dtype=${this.dtype})`}}});var cn={};ns(cn,{cancelPreload:()=>wt,clearModelCache:()=>mt,deleteCachedModel:()=>pt,getCachedModel:()=>ft,getModelCacheStats:()=>gt,getPreloadStatus:()=>yt,getPreloadedModel:()=>xt,isModelCached:()=>ge,loadModelData:()=>V,preloadModel:()=>dt,preloadModels:()=>ht});async function ys(o){try{let t=await fetch(o,{method:"HEAD"}),e=t.headers.get("Accept-Ranges"),n=t.headers.get("Content-Length"),s=t.headers.get("ETag")??void 0;return{supports:e==="bytes",size:n?parseInt(n,10):0,etag:s}}catch{return{supports:!1,size:0}}}async function ws(o,t,e,n){let s=new AbortController,i=setTimeout(()=>s.abort(),n);try{let r=await fetch(o,{headers:{Range:`bytes=${t}-${e}`},signal:s.signal});if(r.status!==206&&r.status!==200)throw new Error(`HTTP ${r.status}: ${r.statusText}`);return await r.arrayBuffer()}finally{clearTimeout(i)}}async function xs(o,t){let{chunkSize:e=5*1024*1024,parallelConnections:n=4,timeout:s=3e4,onProgress:i}=t,{supports:r,size:a,etag:c}=await ys(o);if(!r||a<e*2)return an(o,s,i);let l=await _.getDownloadState(o);if(!l||c&&l.totalSize!==a){let S=Math.ceil(a/e),P=[];for(let E=0;E<S;E++){let z=E*e,A=Math.min(z+e-1,a-1);P.push({index:E,start:z,end:A,downloaded:!1})}l={url:o,totalSize:a,downloadedSize:0,chunks:P,startedAt:Date.now()},await _.deleteModel(o)}let u=l.chunks.filter(S=>!S.downloaded),d=l.downloadedSize,p=Date.now(),m=d,y=()=>{if(!i)return;let S=Date.now(),P=(S-p)/1e3,E=d-m,z=P>0?E/P:0,A=a-d,st=z>0?A/z*1e3:0;i({loaded:d,total:a,percent:d/a*100,speed:z,eta:st,currentChunk:l.chunks.filter($t=>$t.downloaded).length,totalChunks:l.chunks.length}),p=S,m=d},w=[...u],k=new Map;for(;w.length>0||k.size>0;){for(;w.length>0&&k.size<n;){let S=w.shift(),P=(async()=>{try{let E=await ws(o,S.start,S.end,s);await _.saveChunk(o,S.index,E),S.downloaded=!0,d+=E.byteLength,l.downloadedSize=d,await _.saveDownloadState(l),y()}finally{k.delete(S.index)}})();k.set(S.index,P)}k.size>0&&await Promise.race(k.values())}let T=await _.getChunks(o),b=new Uint8Array(a),I=0;for(let S of T)b.set(new Uint8Array(S),I),I+=S.byteLength;return await _.saveMeta({url:o,size:a,etag:c,cachedAt:Date.now(),chunks:T.length,complete:!0}),await _.deleteDownloadState(o),b.buffer}async function an(o,t,e){let n=new AbortController,s=setTimeout(()=>n.abort(),t);try{let i=await fetch(o,{signal:n.signal});if(!i.ok)throw new Error(`HTTP ${i.status}: ${i.statusText}`);let r=i.headers.get("Content-Length"),a=r?parseInt(r,10):0;if(!i.body||!e||a===0)return await i.arrayBuffer();let c=i.body.getReader(),l=[],u=0,d=Date.now();for(;;){let{done:m,value:y}=await c.read();if(m)break;l.push(y),u+=y.length;let w=(Date.now()-d)/1e3,k=w>0?u/w:0,T=a-u,b=k>0?T/k*1e3:0;e({loaded:u,total:a,percent:u/a*100,speed:k,eta:b})}let h=new Uint8Array(u),p=0;for(let m of l)h.set(m,p),p+=m.length;return h.buffer}finally{clearTimeout(s)}}async function V(o,t={}){let{cache:e=!0,forceDownload:n=!1,resumable:s=!0}=t;if(e&&!n){let r=await _.getModel(o);if(r)return console.log(`\u2713 Model loaded from cache: ${o}`),t.onProgress?.({loaded:r.byteLength,total:r.byteLength,percent:100,speed:0,eta:0}),r}let i;return s?i=await xs(o,t):i=await an(o,t.timeout??3e4,t.onProgress),e&&(s||(await _.saveChunk(o,0,i),await _.saveMeta({url:o,size:i.byteLength,cachedAt:Date.now(),chunks:1,complete:!0}))),i}function dt(o,t={}){return me.preload(o,t)}function ht(o,t={}){return Promise.all(o.map(({url:e,priority:n})=>me.preload(e,{...t,priority:n})))}async function ge(o){return(await _.getMeta(o))?.complete??!1}async function ft(o){return _.getModel(o)}async function pt(o){return _.deleteModel(o)}async function mt(){return _.clear()}async function gt(){return _.getStats()}function yt(o){return me.getStatus(o)}function wt(o){me.cancel(o)}async function xt(o){return me.get(o)}var gs,O,q,j,lt,_,ut,me,Ce=rt(()=>{"use strict";gs="edgeflow-model-cache",O="meta",q="chunks",j="download-state",lt=class{constructor(){f(this,"db",null);f(this,"dbPromise",null)}async openDB(){return this.db?this.db:this.dbPromise?this.dbPromise:(this.dbPromise=new Promise((t,e)=>{let n=indexedDB.open(gs,1);n.onupgradeneeded=s=>{let i=s.target.result;i.objectStoreNames.contains(O)||i.createObjectStore(O,{keyPath:"url"}),i.objectStoreNames.contains(q)||i.createObjectStore(q,{keyPath:["url","index"]}).createIndex("url","url",{unique:!1}),i.objectStoreNames.contains(j)||i.createObjectStore(j,{keyPath:"url"})},n.onsuccess=()=>{this.db=n.result,t(this.db)},n.onerror=()=>e(n.error)}),this.dbPromise)}async getMeta(t){let e=await this.openDB();return new Promise((n,s)=>{let a=e.transaction(O,"readonly").objectStore(O).get(t);a.onsuccess=()=>n(a.result??null),a.onerror=()=>s(a.error)})}async saveMeta(t){let e=await this.openDB();return new Promise((n,s)=>{let i=e.transaction(O,"readwrite");i.objectStore(O).put(t),i.oncomplete=()=>n(),i.onerror=()=>s(i.error)})}async saveChunk(t,e,n){let s=await this.openDB();return new Promise((i,r)=>{let a=s.transaction(q,"readwrite");a.objectStore(q).put({url:t,index:e,data:n}),a.oncomplete=()=>i(),a.onerror=()=>r(a.error)})}async getChunks(t){let e=await this.openDB();return new Promise((n,s)=>{let c=e.transaction(q,"readonly").objectStore(q).index("url").getAll(t);c.onsuccess=()=>{let l=c.result;l.sort((u,d)=>u.index-d.index),n(l.map(u=>u.data))},c.onerror=()=>s(c.error)})}async getModel(t){let e=await this.getMeta(t);if(!e||!e.complete)return null;let n=await this.getChunks(t);if(n.length===0)return null;let s=n.reduce((a,c)=>a+c.byteLength,0),i=new Uint8Array(s),r=0;for(let a of n)i.set(new Uint8Array(a),r),r+=a.byteLength;return i.buffer}async saveDownloadState(t){let e=await this.openDB();return new Promise((n,s)=>{let i=e.transaction(j,"readwrite");i.objectStore(j).put(t),i.oncomplete=()=>n(),i.onerror=()=>s(i.error)})}async getDownloadState(t){let e=await this.openDB();return new Promise((n,s)=>{let a=e.transaction(j,"readonly").objectStore(j).get(t);a.onsuccess=()=>n(a.result??null),a.onerror=()=>s(a.error)})}async deleteDownloadState(t){let e=await this.openDB();return new Promise((n,s)=>{let i=e.transaction(j,"readwrite");i.objectStore(j).delete(t),i.oncomplete=()=>n(),i.onerror=()=>s(i.error)})}async deleteModel(t){let e=await this.openDB();await new Promise((s,i)=>{let r=e.transaction(O,"readwrite");r.objectStore(O).delete(t),r.oncomplete=()=>s(),r.onerror=()=>i(r.error)}),(await this.getChunks(t)).length>0&&await new Promise((s,i)=>{let r=e.transaction(q,"readwrite"),l=r.objectStore(q).index("url").openCursor(IDBKeyRange.only(t));l.onsuccess=u=>{let d=u.target.result;d&&(d.delete(),d.continue())},r.oncomplete=()=>s(),r.onerror=()=>i(r.error)}),await this.deleteDownloadState(t)}async clear(){let t=await this.openDB(),e=[O,q,j];for(let n of e)await new Promise((s,i)=>{let r=t.transaction(n,"readwrite");r.objectStore(n).clear(),r.oncomplete=()=>s(),r.onerror=()=>i(r.error)})}async getStats(){let t=await this.openDB();return new Promise((e,n)=>{let r=t.transaction(O,"readonly").objectStore(O).getAll();r.onsuccess=()=>{let a=r.result;e({models:a.filter(c=>c.complete).length,totalSize:a.reduce((c,l)=>c+(l.complete?l.size:0),0)})},r.onerror=()=>n(r.error)})}},_=new lt;ut=class{constructor(){f(this,"tasks",new Map);f(this,"queue",[]);f(this,"maxConcurrent",2);f(this,"activeCount",0)}preload(t,e={}){let n=this.tasks.get(t);if(n)return n.promise;let s,i,r=new Promise((l,u)=>{s=l,i=u}),a={url:t,priority:e.priority??0,options:e,promise:r,resolve:s,reject:i,status:"pending"};this.tasks.set(t,a);let c=this.queue.findIndex(l=>{let u=this.tasks.get(l);return u&&u.priority<a.priority});return c===-1?this.queue.push(t):this.queue.splice(c,0,t),this.processQueue(),r}async processQueue(){for(;this.queue.length>0&&this.activeCount<this.maxConcurrent;){let t=this.queue.shift();if(!t)break;let e=this.tasks.get(t);!e||e.status!=="pending"||(this.activeCount++,e.status="loading",this.downloadTask(e).finally(()=>{this.activeCount--,this.processQueue()}))}}async downloadTask(t){try{let e=await V(t.url,t.options);t.status="complete",t.resolve(e)}catch(e){t.status="error",t.reject(e instanceof Error?e:new Error(String(e)))}}isPreloaded(t){return this.tasks.get(t)?.status==="complete"}getStatus(t){return this.tasks.get(t)?.status??"not_found"}async get(t){let e=this.tasks.get(t);return e&&(e.status==="complete"||e.status==="loading")?e.promise:null}cancel(t){let e=this.tasks.get(t);e&&e.status==="pending"&&(this.tasks.delete(t),this.queue=this.queue.filter(n=>n!==t),e.reject(new Error("Preload cancelled")))}clear(){for(let[,t]of this.tasks)t.status==="pending"&&t.reject(new Error("Preload cleared"));this.tasks.clear(),this.queue=[]}},me=new ut});C();F();C();var at=class{constructor(t,e,n,s){f(this,"id");f(this,"modelId");f(this,"priority");f(this,"createdAt");f(this,"_status","pending");f(this,"_startedAt");f(this,"_completedAt");f(this,"_result");f(this,"_error");f(this,"_executor");f(this,"_resolvers",[]);f(this,"_cancelled",!1);this.id=t,this.modelId=e,this.priority=n,this.createdAt=Date.now(),this._executor=s}get status(){return this._status}get startedAt(){return this._startedAt}get completedAt(){return this._completedAt}get result(){return this._result}get error(){return this._error}cancel(){if(this._status==="pending"){this._cancelled=!0,this._status="cancelled",this._completedAt=Date.now();let t=new x("Task was cancelled",M.INFERENCE_CANCELLED,{taskId:this.id});for(let{reject:e}of this._resolvers)e(t);this._resolvers=[]}}wait(){return this._status==="completed"?Promise.resolve(this._result):this._status==="failed"?Promise.reject(this._error):this._status==="cancelled"?Promise.reject(new x("Task was cancelled",M.INFERENCE_CANCELLED,{taskId:this.id})):new Promise((t,e)=>{this._resolvers.push({resolve:t,reject:e})})}async execute(){if(!this._cancelled){this._status="running",this._startedAt=Date.now();try{this._result=await this._executor(),this._status="completed",this._completedAt=Date.now();for(let{resolve:t}of this._resolvers)t(this._result)}catch(t){this._error=t instanceof Error?t:new Error(String(t)),this._status="failed",this._completedAt=Date.now();for(let{reject:e}of this._resolvers)e(this._error)}this._resolvers=[]}}},rn={critical:0,high:1,normal:2,low:3},ct=class{constructor(){f(this,"items",[])}get length(){return this.items.length}isEmpty(){return this.items.length===0}enqueue(t){let e=!1;for(let n=0;n<this.items.length;n++){let s=this.items[n];if(s&&rn[t.priority]<rn[s.priority]){this.items.splice(n,0,t),e=!0;break}}e||this.items.push(t)}dequeue(){return this.items.shift()}peek(){return this.items[0]}remove(t){let e=this.items.findIndex(n=>n.id===t);if(e!==-1){let[n]=this.items.splice(e,1);return n}}getAll(){return[...this.items]}clear(){this.items=[]}};var is=0;function as(){return`task_${++is}_${Date.now().toString(36)}`}var cs={maxConcurrentTasks:4,maxConcurrentPerModel:1,defaultTimeout:3e4,enableBatching:!1,maxBatchSize:32,batchTimeout:50},he=class{constructor(t={}){f(this,"options");f(this,"queues",new Map);f(this,"runningTasks",new Map);f(this,"allTasks",new Map);f(this,"batchers",new Map);f(this,"listeners",new Map);f(this,"globalRunningCount",0);f(this,"isProcessing",!1);f(this,"disposed",!1);this.options={...cs,...t}}getQueue(t){let e=this.queues.get(t);return e||(e=new ct,this.queues.set(t,e)),e}getRunningSet(t){let e=this.runningTasks.get(t);return e||(e=new Set,this.runningTasks.set(t,e)),e}canStartTask(t){if(this.globalRunningCount>=this.options.maxConcurrentTasks)return!1;let e=this.runningTasks.get(t);return!(e&&e.size>=this.options.maxConcurrentPerModel)}async processQueue(){if(this.isProcessing||this.disposed)return;this.isProcessing=!0;try{let e=[];for(let[n,s]of this.queues)for(;!s.isEmpty()&&this.canStartTask(n);){let i=s.dequeue();i&&i.status==="pending"&&(e.push(i),this.getRunningSet(n).add(i.id),this.globalRunningCount++)}await Promise.all(e.map(async n=>{this.emit("inference:start",{taskId:n.id,modelId:n.modelId});try{await n.execute(),this.emit("inference:complete",{taskId:n.id,modelId:n.modelId,duration:(n.completedAt??0)-(n.startedAt??0)})}catch(s){this.emit("inference:error",{taskId:n.id,modelId:n.modelId,error:s})}finally{let s=this.runningTasks.get(n.modelId);s&&s.delete(n.id),this.globalRunningCount--}}))}finally{this.isProcessing=!1}let t=!1;for(let e of this.queues.values())if(!e.isEmpty()){t=!0;break}t&&setTimeout(()=>this.processQueue(),0)}schedule(t,e,n="normal"){if(this.disposed)throw new x("Scheduler has been disposed",M.RUNTIME_NOT_INITIALIZED);let s=new at(as(),t,n,e);return this.allTasks.set(s.id,s),this.getQueue(t).enqueue(s),this.processQueue(),s}scheduleWithTimeout(t,e,n=this.options.defaultTimeout,s="normal"){let i=()=>new Promise((r,a)=>{let c=setTimeout(()=>{a(new x(`Task timed out after ${n}ms`,M.INFERENCE_TIMEOUT,{timeout:n}))},n);e().then(l=>{clearTimeout(c),r(l)}).catch(l=>{clearTimeout(c),a(l)})});return this.schedule(t,i,s)}async scheduleAll(t){let e=t.map(({modelId:n,executor:s,priority:i})=>this.schedule(n,s,i));return Promise.all(e.map(n=>n.wait()))}getTask(t){return this.allTasks.get(t)}cancelTask(t){let e=this.allTasks.get(t);if(e&&e.status==="pending"){e.cancel();for(let n of this.queues.values())n.remove(t);return!0}return!1}cancelAllForModel(t){let e=this.queues.get(t);if(!e)return 0;let n=0;for(let s of e.getAll())s.status==="pending"&&(s.cancel(),n++);return e.clear(),n}getStats(){let t={totalTasks:this.allTasks.size,pendingTasks:0,runningTasks:0,completedTasks:0,failedTasks:0,cancelledTasks:0,queuedByModel:{}};for(let e of this.allTasks.values())switch(e.status){case"pending":t.pendingTasks++;break;case"running":t.runningTasks++;break;case"completed":t.completedTasks++;break;case"failed":t.failedTasks++;break;case"cancelled":t.cancelledTasks++;break}for(let[e,n]of this.queues)t.queuedByModel[e]=n.length;return t}on(t,e){let n=this.listeners.get(t);n||(n=new Set,this.listeners.set(t,n)),n.add(e)}off(t,e){let n=this.listeners.get(t);n&&n.delete(e)}emit(t,e){let n={type:t,timestamp:Date.now(),data:e},s=this.listeners.get(t);if(s)for(let i of s)try{i(n)}catch(r){console.error("Error in event listener:",r)}}clearHistory(){for(let[t,e]of this.allTasks)(e.status==="completed"||e.status==="failed"||e.status==="cancelled")&&this.allTasks.delete(t)}dispose(){this.disposed=!0;for(let t of this.queues.values()){for(let e of t.getAll())e.cancel();t.clear()}for(let t of this.batchers.values())t.clear();this.queues.clear(),this.runningTasks.clear(),this.allTasks.clear(),this.batchers.clear(),this.listeners.clear()}},ae=null;function _e(){return ae||(ae=new he),ae}function on(o){ae&&ae.dispose(),ae=o}function ls(o){on(new he(o))}var us={initialSize:67108864,maxSize:536870912,growthFactor:1.5,autoGC:!0,gcThreshold:.8},N=class N{constructor(t={}){f(this,"config");f(this,"resources",new Map);f(this,"disposers",new Map);f(this,"listeners",new Map);f(this,"allocated",0);f(this,"peak",0);f(this,"gcScheduled",!1);f(this,"disposed",!1);this.config={...us,...t}}static getInstance(){return N.instance||(N.instance=new N),N.instance}static configure(t){N.instance&&console.warn("MemoryManager already initialized, configuration may not apply"),N.instance=new N(t)}track(t,e){if(this.disposed)return;let n=this.estimateTensorSize(t);this.resources.set(t.id,{id:t.id,type:"tensor",size:n,createdAt:Date.now(),stackTrace:this.captureStackTrace()}),e&&this.disposers.set(t.id,e),this.allocated+=n,this.peak=Math.max(this.peak,this.allocated),this.checkMemoryThreshold()}trackModel(t,e){if(this.disposed)return;let n=t.metadata.sizeBytes;this.resources.set(t.id,{id:t.id,type:"model",size:n,createdAt:Date.now(),stackTrace:this.captureStackTrace()}),e&&this.disposers.set(t.id,e),this.allocated+=n,this.peak=Math.max(this.peak,this.allocated),this.checkMemoryThreshold()}untrack(t){let e=this.resources.get(t);e&&(this.allocated-=e.size,this.resources.delete(t),this.disposers.delete(t))}release(t){let e=typeof t=="string"?t:t.id,n=this.disposers.get(e);if(n)try{n()}catch(s){console.error("Error disposing resource:",s)}this.untrack(e)}estimateTensorSize(t){let e=this.getBytesPerElement(t.dtype);return t.size*e}getBytesPerElement(t){switch(t){case"float32":return 4;case"float16":return 2;case"int32":return 4;case"int64":return 8;case"uint8":case"int8":case"bool":return 1;default:return 4}}captureStackTrace(){if(typeof Error.captureStackTrace=="function"){let t={};return Error.captureStackTrace(t,this.captureStackTrace),t.stack}return new Error().stack}checkMemoryThreshold(){if(!this.config.autoGC)return;let t=this.allocated/this.config.maxSize;t>=this.config.gcThreshold&&!this.gcScheduled&&(this.gcScheduled=!0,this.emit("memory:warning",{allocated:this.allocated,maxSize:this.config.maxSize,usage:t}),setTimeout(()=>{this.gc(),this.gcScheduled=!1},0))}gc(){this.emit("memory:gc",{before:this.allocated});let t=Date.now(),e=[];for(let[n,s]of this.resources)t-s.createdAt>5*60*1e3&&e.push(n);this.emit("memory:gc",{after:this.allocated,potentialCleanup:e.length})}getStats(){let t=0,e=0;for(let n of this.resources.values())n.type==="tensor"?t++:e++;return{allocated:this.allocated,used:this.allocated,peak:this.peak,tensorCount:t,modelCount:e}}getResourceDetails(){return Array.from(this.resources.values())}detectLeaks(t=10*60*1e3){let e=Date.now(),n=[];for(let s of this.resources.values())e-s.createdAt>t&&n.push(s);return n}on(t,e){let n=this.listeners.get(t);n||(n=new Set,this.listeners.set(t,n)),n.add(e)}off(t,e){let n=this.listeners.get(t);n&&n.delete(e)}emit(t,e){let n={type:t,timestamp:Date.now(),data:e},s=this.listeners.get(t);if(s)for(let i of s)try{i(n)}catch(r){console.error("Error in event listener:",r)}}resetStats(){this.peak=this.allocated}disposeAll(){for(let t of this.resources.keys())this.release(t)}dispose(){this.disposeAll(),this.disposed=!0,this.listeners.clear(),N.instance=null}};f(N,"instance",null);var ne=N,fe=class o{constructor(t){f(this,"resources",[]);f(this,"children",[]);f(this,"parent",null);t&&(this.parent=t,t.children.push(this))}track(t){return this.resources.push(t),t}createChild(){return new o(this)}keep(t){let e=this.resources.indexOf(t);return e!==-1&&this.resources.splice(e,1),t}dispose(){for(let t of this.children)t.dispose();this.children=[];for(let t=this.resources.length-1;t>=0;t--)try{this.resources[t]?.dispose()}catch(e){console.error("Error disposing resource in scope:",e)}if(this.resources=[],this.parent){let t=this.parent.children.indexOf(this);t!==-1&&this.parent.children.splice(t,1),this.parent=null}}};async function ds(o){let t=new fe;try{return await o(t)}finally{t.dispose()}}function hs(o){let t=new fe;try{return o(t)}finally{t.dispose()}}var pe=class{constructor(t={}){f(this,"maxSize");f(this,"maxModels");f(this,"cache",new Map);f(this,"currentSize",0);this.maxSize=t.maxSize??256*1024*1024,this.maxModels=t.maxModels??5}get(t){let e=this.cache.get(t);if(e)return e.lastAccess=Date.now(),e.model}set(t,e){let n=e.metadata.sizeBytes;for(;(this.currentSize+n>this.maxSize||this.cache.size>=this.maxModels)&&this.cache.size>0;)this.evictLRU();this.cache.set(t,{model:e,size:n,lastAccess:Date.now()}),this.currentSize+=n}delete(t){let e=this.cache.get(t);return e?(e.model.dispose(),this.currentSize-=e.size,this.cache.delete(t),!0):!1}has(t){return this.cache.has(t)}evictLRU(){let t=null,e=1/0;for(let[n,s]of this.cache)s.lastAccess<e&&(e=s.lastAccess,t=n);t&&this.delete(t)}clear(){for(let t of this.cache.values())t.model.dispose();this.cache.clear(),this.currentSize=0}getStats(){return{size:this.currentSize,count:this.cache.size,maxSize:this.maxSize,maxModels:this.maxModels}}};function R(){return ne.getInstance()}function fs(){return ne.getInstance().getStats()}function ps(o){ne.getInstance().release(o)}function ms(){ne.getInstance().gc()}C();var Ne=new Map,G=new Map,Tt=["webgpu","webnn","wasm"],se=class se{constructor(){f(this,"listeners",new Map);f(this,"defaultRuntime","auto")}static getInstance(){return se.instance||(se.instance=new se),se.instance}register(t,e){Ne.set(t,e)}async getRuntime(t="auto"){if(t==="auto")return this.getBestRuntime();let e=G.get(t);if(e)return e;let n=Ne.get(t);if(!n)throw new x(`Runtime '${t}' is not registered`,M.RUNTIME_NOT_AVAILABLE,{runtime:t});if(e=n(),!await e.isAvailable())throw new x(`Runtime '${t}' is not available in this environment`,M.RUNTIME_NOT_AVAILABLE,{runtime:t});try{await e.initialize()}catch(i){throw new x(`Failed to initialize runtime '${t}': ${i instanceof Error?i.message:String(i)}`,M.RUNTIME_INIT_FAILED,{runtime:t,error:i})}return G.set(t,e),this.emit("runtime:ready",{runtime:t}),e}async getBestRuntime(){for(let t of Tt)try{let e=G.get(t);if(e)return e;let n=Ne.get(t);if(!n)continue;let s=n();if(await s.isAvailable())return await s.initialize(),G.set(t,s),this.emit("runtime:ready",{runtime:t}),s}catch{continue}throw new x("No runtime available. Please ensure WebGPU, WebNN, or WASM is supported.",M.RUNTIME_NOT_AVAILABLE,{triedRuntimes:Tt})}async detectAvailableRuntimes(){let t=new Map;for(let e of Tt){let n=Ne.get(e);if(!n){t.set(e,!1);continue}try{let s=n();t.set(e,await s.isAvailable())}catch{t.set(e,!1)}}return t}async getCapabilities(t){return(await this.getRuntime(t)).capabilities}setDefaultRuntime(t){this.defaultRuntime=t}getDefaultRuntimeType(){return this.defaultRuntime}disposeRuntime(t){let e=G.get(t);e&&(e.dispose(),G.delete(t))}disposeAll(){for(let[t,e]of G)e.dispose(),G.delete(t)}on(t,e){let n=this.listeners.get(t);n||(n=new Set,this.listeners.set(t,n)),n.add(e)}off(t,e){let n=this.listeners.get(t);n&&n.delete(e)}emit(t,e){let n={type:t,timestamp:Date.now(),data:e},s=this.listeners.get(t);if(s)for(let i of s)try{i(n)}catch(r){console.error("Error in event listener:",r)}}};f(se,"instance",null);var $=se,Ts=0;function bs(){return`model_${++Ts}_${Date.now().toString(36)}`}var B=class{constructor(t,e,n){f(this,"id");f(this,"metadata");f(this,"runtime");f(this,"_isLoaded",!0);f(this,"_dispose");this.id=bs(),this.metadata=t,this.runtime=e,this._dispose=n}get isLoaded(){return this._isLoaded}dispose(){this._isLoaded&&(this._isLoaded=!1,this._dispose(),R().untrack(this.id))}};async function bt(o,t={}){let n=await $.getInstance().getRuntime(t.runtime??"auto"),{loadModelData:s}=await Promise.resolve().then(()=>(Ce(),cn)),i=await s(o,{cache:t.cache??!0,resumable:t.resumable??!0,chunkSize:t.chunkSize,forceDownload:t.forceDownload,onProgress:t.onProgress?a=>{t.onProgress(a.percent/100)}:void 0});return await n.loadModel(i,t)}async function Mt(o,t={}){return(await $.getInstance().getRuntime(t.runtime??"auto")).loadModel(o,t)}async function re(o,t){if(!o.isLoaded)throw new x("Model has been disposed",M.MODEL_NOT_LOADED,{modelId:o.id});let n=await $.getInstance().getRuntime(o.runtime);return _e().schedule(o.id,()=>n.run(o,t)).wait()}async function Ms(o,t){let e=_e(),s=await $.getInstance().getRuntime(o.runtime),i=t.map(r=>e.schedule(o.id,()=>s.run(o,r)));return Promise.all(i.map(r=>r.wait()))}function ks(){return $.getInstance()}function ye(o,t){$.getInstance().register(o,t)}async function As(){return $.getInstance().getBestRuntime()}async function we(){return $.getInstance().detectAvailableRuntimes()}C();F();var ce={STORAGE:128,COPY_SRC:4,COPY_DST:8,MAP_READ:1},ln={COMPUTE:4},xe=class{constructor(){f(this,"name","webgpu");f(this,"adapter",null);f(this,"device",null);f(this,"models",new Map);f(this,"initialized",!1)}get capabilities(){return{concurrency:!0,quantization:!0,float16:!0,dynamicShapes:!1,maxBatchSize:64,availableMemory:this.device?.limits.maxBufferSize??256*1024*1024}}async isAvailable(){if(typeof navigator>"u"||!navigator.gpu)return!1;try{return await navigator.gpu.requestAdapter()!==null}catch{return!1}}async initialize(){if(!this.initialized){if(!navigator.gpu)throw new x("WebGPU is not supported in this browser",M.RUNTIME_NOT_AVAILABLE);if(this.adapter=await navigator.gpu.requestAdapter({powerPreference:"high-performance"}),!this.adapter)throw new x("Failed to get WebGPU adapter",M.RUNTIME_INIT_FAILED);this.device=await this.adapter.requestDevice({requiredFeatures:[],requiredLimits:{}}),this.device.lost.then(t=>{console.error("WebGPU device was lost:",t.message),this.initialized=!1,this.device=null}),this.initialized=!0}}async loadModel(t,e={}){this.ensureInitialized();let n=this.parseModelData(t),s={shaders:new Map,pipelines:new Map,weights:new Map,bindGroupLayouts:[],config:n};await this.uploadWeights(t,s),await this.createPipelines(s);let i=`webgpu_${Date.now().toString(36)}`;this.models.set(i,s);let r={name:n.name||e.metadata?.name||"unknown",version:n.version,inputs:n.inputs.map(c=>({name:c.name,dtype:c.dtype,shape:c.shape})),outputs:n.outputs.map(c=>({name:c.name,dtype:c.dtype,shape:c.shape})),sizeBytes:t.byteLength,quantization:e.quantization??"float32",format:"edgeflow"},a=new B(r,"webgpu",()=>this.unloadModel(i));return R().trackModel(a,()=>a.dispose()),a}async run(t,e){return this.ensureInitialized(),this.executeModel(e,t.metadata)}async executeModel(t,e){let n=this.device,s=[];for(let i of e.outputs){let r=i.shape.reduce((u,d)=>u*d,1),a=n.createBuffer({size:r*4,usage:ce.STORAGE|ce.COPY_SRC}),c=n.createBuffer({size:r*4,usage:ce.MAP_READ|ce.COPY_DST}),l=new Float32Array(r);if(t.length>0&&t[0]){let u=t[0].toFloat32Array();for(let d=0;d<Math.min(r,u.length);d++)l[d]=u[d]??0}s.push(new g(l,i.shape,"float32")),a.destroy(),c.destroy()}return s}parseModelData(t){try{let e=new TextDecoder,n=e.decode(new Uint8Array(t,0,Math.min(1024,t.byteLength)));if(n.trim().startsWith("{")){let s=n.indexOf(`
---
`);s===-1&&(s=t.byteLength);let i=e.decode(new Uint8Array(t,0,s));return JSON.parse(i)}}catch{}return{name:"unknown",version:"1.0.0",layers:[],inputs:[{name:"input",shape:[-1,768],dtype:"float32"}],outputs:[{name:"output",shape:[-1,768],dtype:"float32"}]}}async uploadWeights(t,e){let s=this.device.createBuffer({size:1024,usage:ce.STORAGE|ce.COPY_DST});e.weights.set("default",s)}async createPipelines(t){let e=this.device,s=e.createShaderModule({code:`
      @group(0) @binding(0) var<storage, read> input: array<f32>;
      @group(0) @binding(1) var<storage, read_write> output: array<f32>;
      
      @compute @workgroup_size(64)
      fn main(@builtin(global_invocation_id) gid: vec3<u32>) {
        let idx = gid.x;
        if (idx < arrayLength(&input)) {
          output[idx] = input[idx];
        }
      }
    `});t.shaders.set("default",s);let i=e.createBindGroupLayout({entries:[{binding:0,visibility:ln.COMPUTE,buffer:{type:"read-only-storage"}},{binding:1,visibility:ln.COMPUTE,buffer:{type:"storage"}}]});t.bindGroupLayouts.push(i);let r=e.createPipelineLayout({bindGroupLayouts:[i]}),a=e.createComputePipeline({layout:r,compute:{module:s,entryPoint:"main"}});t.pipelines.set("default",a)}unloadModel(t){let e=this.models.get(t);if(e){for(let n of e.weights.values())n.destroy();this.models.delete(t)}}ensureInitialized(){if(!this.initialized||!this.device)throw new x("WebGPU runtime is not initialized",M.RUNTIME_NOT_INITIALIZED)}dispose(){for(let t of this.models.keys())this.unloadModel(t);this.device&&(this.device.destroy(),this.device=null),this.adapter=null,this.initialized=!1}};function Re(){return new xe}C();F();var Te=class{constructor(){f(this,"name","webnn");f(this,"context",null);f(this,"models",new Map);f(this,"initialized",!1);f(this,"deviceType","default")}get capabilities(){return{concurrency:!0,quantization:!0,float16:!0,dynamicShapes:!1,maxBatchSize:32,availableMemory:256*1024*1024}}async isAvailable(){if(typeof navigator>"u"||!navigator.ml)return!1;try{return await navigator.ml.createContext({deviceType:"default"})!==null}catch{return!1}}async initialize(){if(!this.initialized){if(!navigator.ml)throw new x("WebNN is not supported in this browser",M.RUNTIME_NOT_AVAILABLE);try{this.context=await navigator.ml.createContext({deviceType:"gpu",powerPreference:"high-performance"}),this.deviceType="gpu"}catch{try{this.context=await navigator.ml.createContext({deviceType:"cpu"}),this.deviceType="cpu"}catch(t){throw new x(`Failed to create WebNN context: ${t instanceof Error?t.message:String(t)}`,M.RUNTIME_INIT_FAILED)}}this.initialized=!0}}async loadModel(t,e={}){this.ensureInitialized();let n=this.parseModelConfig(t),s=`webnn_${Date.now().toString(36)}`,i={name:n.name||e.metadata?.name||"unknown",version:n.version||"1.0.0",inputs:n.inputs.map(a=>({name:a.name,dtype:a.dtype,shape:a.shape})),outputs:n.outputs.map(a=>({name:a.name,dtype:a.dtype,shape:a.shape})),sizeBytes:t.byteLength,quantization:e.quantization??"float32",format:"edgeflow"},r=new B(i,"webnn",()=>this.unloadModel(s));return R().trackModel(r,()=>r.dispose()),r}async run(t,e){return this.ensureInitialized(),this.executeModel(e,t.metadata)}async executeModel(t,e){let n=[];for(let s of e.outputs){let i=s.shape.reduce((a,c)=>a*c,1),r=new Float32Array(i);if(t.length>0&&t[0]){let a=t[0].toFloat32Array();for(let c=0;c<Math.min(i,a.length);c++)r[c]=a[c]??0}n.push(new g(r,s.shape,"float32"))}return n}parseModelConfig(t){try{let e=new TextDecoder,n=e.decode(new Uint8Array(t,0,Math.min(1024,t.byteLength)));if(n.trim().startsWith("{")){let s=n.indexOf(`
---
`);s===-1&&(s=t.byteLength);let i=e.decode(new Uint8Array(t,0,s));return JSON.parse(i)}}catch{}return{name:"unknown",version:"1.0.0",inputs:[{name:"input",shape:[-1,768],dtype:"float32"}],outputs:[{name:"output",shape:[-1,768],dtype:"float32"}]}}unloadModel(t){this.models.delete(t)}ensureInitialized(){if(!this.initialized||!this.context)throw new x("WebNN runtime is not initialized",M.RUNTIME_NOT_INITIALIZED)}getDeviceType(){return this.deviceType}dispose(){this.models.clear(),this.context=null,this.initialized=!1}};function Oe(){return new Te}C();F();var be=class{constructor(){f(this,"name","wasm");f(this,"module",null);f(this,"simdSupported",!1);f(this,"models",new Map);f(this,"initialized",!1)}get capabilities(){return{concurrency:!1,quantization:!0,float16:!1,dynamicShapes:!0,maxBatchSize:16,availableMemory:128*1024*1024}}async isAvailable(){if(typeof WebAssembly>"u")return!1;try{let t=new Uint8Array([0,97,115,109,1,0,0,0]);return await WebAssembly.instantiate(t),!0}catch{return!1}}async initialize(){if(this.initialized)return;this.simdSupported=await this.checkSIMDSupport();let t=new WebAssembly.Memory({initial:256,maximum:2048});this.module={memory:t,exports:this.createJSFallback(t)},this.initialized=!0}async checkSIMDSupport(){try{let t=new Uint8Array([0,97,115,109,1,0,0,0,1,5,1,96,0,1,123,3,2,1,0,10,10,1,8,0,253,12,0,0,0,0,11]);return await WebAssembly.instantiate(t),!0}catch{return!1}}createJSFallback(t){let e=0,n=new Map;return{malloc:s=>{let i=e;return e+=s,n.set(i,s),i},free:s=>{n.delete(s)},matmul_f32:(s,i,r,a,c,l,u)=>{let d=new Float32Array(t.buffer),h=s/4,p=a/4,m=u/4;for(let y=0;y<i;y++)for(let w=0;w<l;w++){let k=0;for(let T=0;T<r;T++)k+=(d[h+y*r+T]??0)*(d[p+T*l+w]??0);d[m+y*l+w]=k}},add_f32:(s,i,r,a)=>{let c=new Float32Array(t.buffer),l=s/4,u=i/4,d=r/4;for(let h=0;h<a;h++)c[d+h]=(c[l+h]??0)+(c[u+h]??0)},mul_f32:(s,i,r,a)=>{let c=new Float32Array(t.buffer),l=s/4,u=i/4,d=r/4;for(let h=0;h<a;h++)c[d+h]=(c[l+h]??0)*(c[u+h]??0)},relu_f32:(s,i,r)=>{let a=new Float32Array(t.buffer),c=s/4,l=i/4;for(let u=0;u<r;u++)a[l+u]=Math.max(0,a[c+u]??0)},sigmoid_f32:(s,i,r)=>{let a=new Float32Array(t.buffer),c=s/4,l=i/4;for(let u=0;u<r;u++)a[l+u]=1/(1+Math.exp(-(a[c+u]??0)))},softmax_f32:(s,i,r)=>{let a=new Float32Array(t.buffer),c=s/4,l=i/4,u=-1/0;for(let h=0;h<r;h++)(a[c+h]??0)>u&&(u=a[c+h]??0);let d=0;for(let h=0;h<r;h++)a[l+h]=Math.exp((a[c+h]??0)-u),d+=a[l+h]??0;for(let h=0;h<r;h++)a[l+h]=(a[l+h]??0)/d}}}async loadModel(t,e={}){this.ensureInitialized();let n=this.parseModelConfig(t),s={weights:new Map,config:n,executionOrder:n.layers.map(c=>c.name)};await this.loadWeights(t,s);let i=`wasm_${Date.now().toString(36)}`;this.models.set(i,s);let r={name:n.name||e.metadata?.name||"unknown",version:n.version||"1.0.0",inputs:n.inputs.map(c=>({name:c.name,dtype:c.dtype,shape:c.shape})),outputs:n.outputs.map(c=>({name:c.name,dtype:c.dtype,shape:c.shape})),sizeBytes:t.byteLength,quantization:e.quantization??"float32",format:"edgeflow"},a=new B(r,"wasm",()=>this.unloadModel(i));return R().trackModel(a,()=>a.dispose()),a}async run(t,e){return this.ensureInitialized(),this.executeModel(e,t.metadata)}async executeModel(t,e){let n=[];for(let s of e.outputs){let i=s.shape.reduce((a,c)=>a*c,1),r;if(t.length>0&&t[0]){let a=t[0];if(s.name.includes("logits")||s.name.includes("class"))r=L(a);else if(s.name.includes("relu"))r=De(a);else if(s.name.includes("sigmoid"))r=Le(a);else{let c=new Float32Array(i),l=a.toFloat32Array();for(let u=0;u<Math.min(i,l.length);u++)c[u]=l[u]??0;r=new g(c,s.shape,"float32")}}else r=new g(new Float32Array(i),s.shape,"float32");n.push(r)}return n}parseModelConfig(t){try{let e=new TextDecoder,n=e.decode(new Uint8Array(t,0,Math.min(2048,t.byteLength)));if(n.trim().startsWith("{")){let s=n.indexOf(`
---
`);if(s===-1)try{return JSON.parse(n)}catch{s=t.byteLength}let i=e.decode(new Uint8Array(t,0,s));return JSON.parse(i)}}catch{}return{name:"unknown",version:"1.0.0",layers:[],inputs:[{name:"input",shape:[-1,768],dtype:"float32"}],outputs:[{name:"output",shape:[-1,768],dtype:"float32"}]}}async loadWeights(t,e){}unloadModel(t){let e=this.models.get(t);if(e&&this.module)for(let n of e.weights.values())this.module.exports.free(n.ptr);this.models.delete(t)}ensureInitialized(){if(!this.initialized||!this.module)throw new x("WASM runtime is not initialized",M.RUNTIME_NOT_INITIALIZED)}hasSIMDSupport(){return this.simdSupported}dispose(){for(let t of this.models.keys())this.unloadModel(t);this.module=null,this.initialized=!1}};function un(){return new be}C();import*as X from"onnxruntime-web";F();var Me=new Map,kt=class{constructor(){f(this,"name","wasm");f(this,"initialized",!1);f(this,"executionProvider","wasm")}get capabilities(){return{concurrency:!0,quantization:!0,float16:this.executionProvider==="webgpu",dynamicShapes:!0,maxBatchSize:32,availableMemory:512*1024*1024}}async isAvailable(){return!0}async initialize(){this.initialized||(typeof window<"u"&&(X.env.wasm.wasmPaths="https://cdn.jsdelivr.net/npm/onnxruntime-web@1.17.0/dist/"),this.executionProvider="wasm",this.initialized=!0)}async loadModel(t,e={}){this.initialized||await this.initialize();try{let n={executionProviders:[this.executionProvider],graphOptimizationLevel:"all"},s=new Uint8Array(t),i=await X.InferenceSession.create(s,n),r=i.inputNames,a=i.outputNames,c=`onnx_${Date.now().toString(36)}_${Math.random().toString(36).slice(2,8)}`;Me.set(c,{session:i,inputNames:[...r],outputNames:[...a]});let l={name:e.metadata?.name??"onnx-model",version:"1.0.0",inputs:r.map(d=>({name:d,dtype:"float32",shape:[-1]})),outputs:a.map(d=>({name:d,dtype:"float32",shape:[-1]})),sizeBytes:t.byteLength,quantization:e.quantization??"float32",format:"onnx"},u=new B(l,"wasm",()=>this.unloadModel(c));return Object.defineProperty(u,"id",{value:c,writable:!1}),R().trackModel(u,()=>u.dispose()),u}catch(n){throw new x(`Failed to load ONNX model: ${n instanceof Error?n.message:String(n)}`,M.MODEL_LOAD_FAILED,{error:n})}}async run(t,e){let n=Me.get(t.id);if(!n)throw new x(`ONNX session not found for model ${t.id}`,M.MODEL_NOT_LOADED,{modelId:t.id});let{session:s,inputNames:i,outputNames:r}=n;try{let a={};for(let u=0;u<Math.min(e.length,i.length);u++){let d=i[u],h=e[u];if(d&&h){let p=h.dtype,m;if(p==="int64"){let y=h.data;m=new X.Tensor("int64",y,h.shape)}else if(p==="int32"){let y=h.data;m=new X.Tensor("int32",y,h.shape)}else{let y=h.toFloat32Array();m=new X.Tensor("float32",y,h.shape)}a[d]=m}}let c=await s.run(a),l=[];for(let u of r){let d=c[u];if(d){let h=d.data,p=Array.from(d.dims).map(m=>Number(m));l.push(new g(new Float32Array(h),p,"float32"))}}return l}catch(a){throw new x(`ONNX inference failed: ${a instanceof Error?a.message:String(a)}`,M.INFERENCE_FAILED,{modelId:t.id,error:a})}}async unloadModel(t){Me.get(t)&&Me.delete(t)}dispose(){Me.clear(),this.initialized=!1}};function dn(){return new kt}function hn(){ye("webgpu",Re),ye("webnn",Oe),ye("wasm",dn)}hn();var le=class{constructor(t={}){f(this,"options");f(this,"cache",new Map);f(this,"currentSize",0);f(this,"hits",0);f(this,"misses",0);this.options={strategy:t.strategy??"lru",maxSize:t.maxSize??100*1024*1024,maxEntries:t.maxEntries??1e3,ttl:t.ttl??0,persistent:t.persistent??!1,name:t.name??"edgeflow-cache"},this.options.persistent&&this.loadFromStorage()}get(t){let e=this.cache.get(t);if(!e){this.misses++;return}if(e.ttl&&Date.now()-e.createdAt>e.ttl){this.delete(t),this.misses++;return}return e.accessedAt=Date.now(),e.accessCount++,this.hits++,e.value}set(t,e,n,s){for(this.cache.has(t)&&this.delete(t);(this.currentSize+n>this.options.maxSize||this.cache.size>=this.options.maxEntries)&&this.cache.size>0;)this.evict();let i=s!==void 0?s:this.options.ttl>0?this.options.ttl:void 0,r={value:e,size:n,createdAt:Date.now(),accessedAt:Date.now(),accessCount:1,ttl:i};this.cache.set(t,r),this.currentSize+=n,this.options.persistent&&this.saveToStorage()}has(t){let e=this.cache.get(t);return e?e.ttl&&Date.now()-e.createdAt>e.ttl?(this.delete(t),!1):!0:!1}delete(t){let e=this.cache.get(t);return e?(this.currentSize-=e.size,this.cache.delete(t),this.options.persistent&&this.saveToStorage(),!0):!1}clear(){this.cache.clear(),this.currentSize=0,this.hits=0,this.misses=0,this.options.persistent&&this.clearStorage()}getStats(){let t=this.hits+this.misses;return{entries:this.cache.size,size:this.currentSize,hits:this.hits,misses:this.misses,hitRate:t>0?this.hits/t:0}}evict(){let t=null;switch(this.options.strategy){case"lru":t=this.findLRU();break;case"lfu":t=this.findLFU();break;case"fifo":t=this.findOldest();break;case"ttl":t=this.findExpired()??this.findOldest();break}t&&this.delete(t)}findLRU(){let t=null,e=1/0;for(let[n,s]of this.cache)s.accessedAt<e&&(e=s.accessedAt,t=n);return t}findLFU(){let t=null,e=1/0;for(let[n,s]of this.cache)s.accessCount<e&&(e=s.accessCount,t=n);return t}findOldest(){let t=null,e=1/0;for(let[n,s]of this.cache)s.createdAt<e&&(e=s.createdAt,t=n);return t}findExpired(){let t=Date.now();for(let[e,n]of this.cache)if(n.ttl&&t-n.createdAt>n.ttl)return e;return null}async loadFromStorage(){if(!(typeof indexedDB>"u"))try{let s=(await this.openDB()).transaction("cache","readonly").objectStore("cache").getAll();return new Promise((i,r)=>{s.onsuccess=()=>{let a=s.result;for(let{key:c,entry:l}of a)this.cache.set(c,l),this.currentSize+=l.size;i()},s.onerror=()=>r(s.error)})}catch{}}async saveToStorage(){if(!(typeof indexedDB>"u"))try{let e=(await this.openDB()).transaction("cache","readwrite"),n=e.objectStore("cache");n.clear();for(let[s,i]of this.cache)n.put({key:s,entry:i});return new Promise((s,i)=>{e.oncomplete=()=>s(),e.onerror=()=>i(e.error)})}catch{}}async clearStorage(){if(!(typeof indexedDB>"u"))try{(await this.openDB()).transaction("cache","readwrite").objectStore("cache").clear()}catch{}}openDB(){return new Promise((t,e)=>{let n=indexedDB.open(this.options.name,1);n.onupgradeneeded=()=>{let s=n.result;s.objectStoreNames.contains("cache")||s.createObjectStore("cache",{keyPath:"key"})},n.onsuccess=()=>t(n.result),n.onerror=()=>e(n.error)})}},$e=class extends le{generateKey(t,e){let n=Array.isArray(e)?e:Array.from(e),s=this.hashArray(n);return`${t}:${s}`}hashArray(t){let e=0,n=t.length>100?t.filter((s,i)=>i%Math.floor(t.length/100)===0):t;for(let s=0;s<n.length;s++){let i=n[s]??0;e=(e<<5)-e+(i*1e3|0),e|=0}return e.toString(36)}},Q=class{constructor(t="edgeflow-models"){f(this,"cacheName");f(this,"cache",null);this.cacheName=t}async ensureCache(){if(!this.cache){if(typeof caches>"u")throw new Error("Cache API is not available");this.cache=await caches.open(this.cacheName)}return this.cache}async get(t){try{return await(await this.ensureCache()).match(t)??void 0}catch{return}}async put(t,e){try{await(await this.ensureCache()).put(t,e.clone())}catch{}}async delete(t){try{return await(await this.ensureCache()).delete(t)}catch{return!1}}async clear(){try{await caches.delete(this.cacheName),this.cache=null}catch{}}async keys(){try{return(await(await this.ensureCache()).keys()).map(n=>n.url)}catch{return[]}}};function fn(o="medium",t={}){let e={small:{maxSize:10485760,maxEntries:100},medium:{maxSize:104857600,maxEntries:500},large:{maxSize:524288e3,maxEntries:2e3},custom:{}};return new le({...e[o],...t})}var v=class{constructor(t){f(this,"model",null);f(this,"config");f(this,"modelCache");f(this,"downloadCache");f(this,"isReady",!1);this.config=t,this.modelCache=new pe,this.downloadCache=new Q}async initialize(){if(this.isReady&&this.model)return;let t=this.modelCache.get(this.config.model);if(t){this.model=t,this.isReady=!0;return}this.model=await this.loadModelWithCache(this.config.model),this.isReady=!0}async loadModelWithCache(t){let e=await this.downloadCache.get(t);try{let n=await fetch(t);n.ok&&await this.downloadCache.put(t,n.clone())}catch{}return bt(t,{runtime:this.config.runtime,quantization:this.config.quantization,cache:this.config.cache})}async run(t,e){await this.initialize();let n=performance.now(),s=await this.preprocess(t),i=await re(this.model,s),r=await this.postprocess(i,e);return r&&typeof r=="object"&&"processingTime"in r&&(r.processingTime=performance.now()-n),r}async runBatch(t,e){return await this.initialize(),await Promise.all(t.map(s=>this.run(s,e)))}get task(){return this.config.task}get ready(){return this.isReady}dispose(){this.model&&(this.model.dispose(),this.model=null),this.isReady=!1}},pn=new Map;function U(o,t){pn.set(o,t)}function mn(o){return pn.get(o)}var ke=["negative","positive"],gn=["anger","disgust","fear","joy","sadness","surprise","neutral"],Be=["tench","goldfish","great white shark","tiger shark","hammerhead","electric ray","stingray","cock","hen","ostrich"];F();C();var W=class o{constructor(){f(this,"vocab",new Map);f(this,"reverseVocab",new Map);f(this,"merges",new Map);f(this,"addedTokens",new Map);f(this,"specialTokens",new Set);f(this,"modelType","BPE");f(this,"unkToken","[UNK]");f(this,"continuingSubwordPrefix","##");f(this,"padTokenId",0);f(this,"unkTokenId",0);f(this,"clsTokenId");f(this,"sepTokenId");f(this,"maskTokenId");f(this,"bosTokenId");f(this,"eosTokenId");f(this,"maxLength",512);f(this,"doLowerCase",!1);f(this,"stripAccents",!1);f(this,"postProcessor");f(this,"byteEncoder",new Map);f(this,"byteDecoder",new Map);this.initByteEncoder()}initByteEncoder(){let t=[];for(let s=33;s<=126;s++)t.push(s);for(let s=161;s<=172;s++)t.push(s);for(let s=174;s<=255;s++)t.push(s);let e=[...t],n=0;for(let s=0;s<256;s++)t.includes(s)||(t.push(s),e.push(256+n),n++);for(let s=0;s<t.length;s++){let i=t[s],r=String.fromCharCode(e[s]);this.byteEncoder.set(i,r),this.byteDecoder.set(r,i)}}static async fromJSON(t){let e=new o,n=typeof t=="string"?JSON.parse(t):t;if(n.model){if(e.modelType=n.model.type,n.model.vocab)for(let[a,c]of Object.entries(n.model.vocab))e.vocab.set(a,c),e.reverseVocab.set(c,a);if(n.model.merges)for(let a=0;a<n.model.merges.length;a++)e.merges.set(n.model.merges[a],a);e.unkToken=n.model.unk_token??"[UNK]",e.continuingSubwordPrefix=n.model.continuing_subword_prefix??"##"}let s=a=>e.vocab.get(a),i=s("[PAD]");i!==void 0&&(e.padTokenId=i);let r=s("[UNK]");if(r!==void 0&&(e.unkTokenId=r),e.clsTokenId??(e.clsTokenId=s("[CLS]")),e.sepTokenId??(e.sepTokenId=s("[SEP]")),e.maskTokenId??(e.maskTokenId=s("[MASK]")),e.bosTokenId??(e.bosTokenId=s("<s>")),e.eosTokenId??(e.eosTokenId=s("</s>")),n.added_tokens)for(let a of n.added_tokens){e.addedTokens.set(a.content,a.id),e.reverseVocab.set(a.id,a.content),a.special&&e.specialTokens.add(a.content);let c=a.content.toLowerCase();c.includes("pad")&&(e.padTokenId=a.id),c.includes("unk")&&(e.unkTokenId=a.id),(c.includes("cls")||c==="[cls]")&&(e.clsTokenId=a.id),(c.includes("sep")||c==="[sep]")&&(e.sepTokenId=a.id),c.includes("mask")&&(e.maskTokenId=a.id),(c.includes("bos")||c==="<s>")&&(e.bosTokenId=a.id),(c.includes("eos")||c==="</s>")&&(e.eosTokenId=a.id)}return n.normalizer&&(e.doLowerCase=n.normalizer.lowercase??!1,e.stripAccents=n.normalizer.strip_accents??!1),n.truncation&&(e.maxLength=n.truncation.max_length),n.post_processor&&(e.postProcessor=n.post_processor),e}static async fromUrl(t){let e=await fetch(t);if(!e.ok)throw new x(`Failed to load tokenizer from ${t}: ${e.status}`,M.MODEL_NOT_FOUND);let n=await e.json();return o.fromJSON(n)}static async fromHuggingFace(t,e){let n=e?.revision??"main",s=`https://huggingface.co/${t}/resolve/${n}/tokenizer.json`;return o.fromUrl(s)}normalize(t){let e=t;return this.doLowerCase&&(e=e.toLowerCase()),this.stripAccents&&(e=e.normalize("NFD").replace(/[\u0300-\u036f]/g,"")),e=e.replace(/\s+/g," ").trim(),e}preTokenize(t){if(this.modelType==="WordPiece"){let s=/\p{L}+|\p{N}+|[^\s\p{L}\p{N}]+/gu;return t.match(s)??[t]}let e=/'s|'t|'re|'ve|'m|'ll|'d| ?\p{L}+| ?\p{N}+| ?[^\s\p{L}\p{N}]+|\s+(?!\S)|\s+/gu;return t.match(e)??[t]}textToBytes(t){let n=new TextEncoder().encode(t);return Array.from(n).map(s=>this.byteEncoder.get(s)??"").join("")}bytesToText(t){let e=new Uint8Array(t.split("").map(s=>this.byteDecoder.get(s)??0));return new TextDecoder("utf-8",{fatal:!1}).decode(e)}getPairs(t){let e=new Set;for(let n=0;n<t.length-1;n++)e.add(`${t[n]} ${t[n+1]}`);return e}bpe(t){if(this.vocab.has(t))return[t];let e=t.split(""),n=this.getPairs(e);if(n.size===0)return[t];for(;;){let s=null,i=1/0;for(let d of n){let h=this.merges.get(d);h!==void 0&&h<i&&(i=h,s=d)}if(s===null)break;let r=s.split(" "),a=r[0],c=r[1];if(!a||!c)break;let l=[],u=0;for(;u<e.length;){let d=e.indexOf(a,u);if(d===-1){l.push(...e.slice(u));break}l.push(...e.slice(u,d)),e[d]===a&&d<e.length-1&&e[d+1]===c?(l.push(a+c),u=d+2):(l.push(e[d]),u=d+1)}if(e=l,e.length===1)break;n=this.getPairs(e)}return e}wordPiece(t){if(this.vocab.has(t))return[t];let e=[],n=0;for(;n<t.length;){let s=t.length,i=null;for(;n<s;){let r=t.slice(n,s);if(n>0&&(r=this.continuingSubwordPrefix+r),this.vocab.has(r)){i=r;break}s--}i===null?(e.push(this.unkToken),n++):(e.push(i),n=s)}return e}tokenizeWord(t){if(this.modelType==="WordPiece"&&(t=t.trimStart()),this.addedTokens.has(t))return[t];switch(this.modelType){case"BPE":{let e=this.textToBytes(t);return this.bpe(e)}case"WordPiece":return this.wordPiece(t);default:return this.vocab.has(t)?[t]:[this.unkToken]}}tokenize(t){let e=this.normalize(t),n=[],s=e,i=Array.from(this.addedTokens.keys()).sort((r,a)=>a.length-r.length);for(let r of i)if(s.includes(r)){let a=s.split(r),c=[];for(let l=0;l<a.length;l++)a[l]&&c.push(a[l]),l<a.length-1&&n.push(r);s=c.join(" ")}if(s.trim()){let r=this.preTokenize(s);for(let a of r){if(!a)continue;let c=this.tokenizeWord(a);n.push(...c)}}return n}convertTokensToIds(t){return t.map(e=>{let n=this.addedTokens.get(e);if(n!==void 0)return n;let s=this.vocab.get(e);return s!==void 0?s:this.unkTokenId})}convertIdsToTokens(t){return t.map(e=>this.reverseVocab.get(e)??this.unkToken)}postProcess(t,e){if(!this.postProcessor){let r=[],a=[];return this.clsTokenId!==void 0&&(r.push(this.clsTokenId),a.push(0)),r.push(...t),a.push(...t.map(()=>0)),this.sepTokenId!==void 0&&(r.push(this.sepTokenId),a.push(0)),e&&(r.push(...e),a.push(...e.map(()=>1)),this.sepTokenId!==void 0&&(r.push(this.sepTokenId),a.push(1))),{ids:r,typeIds:a}}let n=e?this.postProcessor.pair:this.postProcessor.single;if(!n)return{ids:t,typeIds:t.map(()=>0)};let s=[],i=[];for(let r of n)if("SpecialToken"in r){let a=this.postProcessor.special_tokens?.[r.SpecialToken.id];a&&(s.push(...a.ids),i.push(...a.ids.map(()=>r.SpecialToken.type_id)))}else if("Sequence"in r){let a=r.Sequence.id==="A"?t:e??[];s.push(...a),i.push(...a.map(()=>r.Sequence.type_id))}return{ids:s,typeIds:i}}encode(t,e={}){let{addSpecialTokens:n=!0,maxLength:s=this.maxLength,padding:i="max_length",truncation:r=!0,returnAttentionMask:a=!0,returnTokenTypeIds:c=!1,textPair:l}=e,u=this.tokenize(t),d=this.convertTokensToIds(u),h;if(l){let w=this.tokenize(l);h=this.convertTokensToIds(w)}let p;if(n){let w=this.postProcess(d,h);d=w.ids,c&&(p=w.typeIds)}else h&&(d=[...d,...h],c&&(p=[...d.map(()=>0),...h.map(()=>1)]));r&&d.length>s&&(d=d.slice(0,s),p&&(p=p.slice(0,s)));let m=[];if(a&&(m=d.map(()=>1)),i==="max_length"&&d.length<s){let w=s-d.length;d=[...d,...new Array(w).fill(this.padTokenId)],a&&(m=[...m,...new Array(w).fill(0)]),p&&(p=[...p,...new Array(w).fill(0)])}let y={inputIds:d,attentionMask:m};return c&&p&&(y.tokenTypeIds=p),y}encodeBatch(t,e={}){if(e.padding==="longest"){let n=t.map(i=>this.encode(i,{...e,padding:"do_not_pad"})),s=Math.max(...n.map(i=>i.inputIds.length));return t.map(i=>this.encode(i,{...e,maxLength:s,padding:"max_length"}))}return t.map(n=>this.encode(n,e))}decode(t,e=!0){let n=this.convertIdsToTokens(t);e&&(n=n.filter(i=>!this.specialTokens.has(i)));let s=n.join("");return this.modelType==="BPE"&&(s=this.bytesToText(s)),this.modelType==="WordPiece"&&(s=s.replace(new RegExp(this.continuingSubwordPrefix,"g"),"")),s=s.replace(/\s+/g," ").trim(),s}decodeBatch(t,e=!0){return t.map(n=>this.decode(n,e))}get vocabSize(){return this.vocab.size+this.addedTokens.size}getSpecialTokenIds(){return{padTokenId:this.padTokenId,unkTokenId:this.unkTokenId,clsTokenId:this.clsTokenId,sepTokenId:this.sepTokenId,maskTokenId:this.maskTokenId,bosTokenId:this.bosTokenId,eosTokenId:this.eosTokenId}}getConfig(){return{vocabSize:this.vocabSize,maxLength:this.maxLength,padTokenId:this.padTokenId,unkTokenId:this.unkTokenId,clsTokenId:this.clsTokenId,sepTokenId:this.sepTokenId,maskTokenId:this.maskTokenId,bosTokenId:this.bosTokenId,eosTokenId:this.eosTokenId}}isSpecialToken(t){return this.specialTokens.has(t)}getTokenId(t){return this.addedTokens.get(t)??this.vocab.get(t)}getToken(t){return this.reverseVocab.get(t)}};function ue(){return new W}async function yn(o){return W.fromUrl(o)}async function Ue(o,t){return W.fromHuggingFace(o,t)}var H=class extends v{constructor(e,n){super(e);f(this,"tokenizer",null);f(this,"labels");this.labels=n??ke}async initialize(){await super.initialize(),this.tokenizer||(this.tokenizer=ue())}setLabels(e){this.labels=e}async run(e,n){let s=Array.isArray(e),i=s?e:[e];await this.initialize();let r=performance.now(),a=[];for(let l of i){let u=await this.preprocess(l),d=await this.runInference(u),h=await this.postprocess(d,n);a.push(h)}let c=performance.now()-r;for(let l of a)l.processingTime=c/a.length;return s?a:a[0]}async preprocess(e){let n=Array.isArray(e)?e[0]:e,s=this.tokenizer.encode(n,{maxLength:128,padding:"max_length",truncation:!0}),i=new g(new Float32Array(s.inputIds),[1,s.inputIds.length],"float32"),r=new g(new Float32Array(s.attentionMask),[1,s.attentionMask.length],"float32");return[i,r]}async runInference(e){let n=this.labels.length,s=new Float32Array(n),r=(e[0]?.toFloat32Array()??new Float32Array(0)).reduce((a,c)=>a+c,0);for(let a=0;a<n;a++)s[a]=Math.sin(r*(a+1))*2;return[new g(s,[1,n],"float32")]}async postprocess(e,n){let s=e[0];if(!s)return{label:"unknown",score:0};let r=L(s,-1).toFloat32Array(),a=n?.topK??1;(n?.returnAllScores??!1)||a>1;let l=0,u=r[0]??0;for(let h=1;h<r.length;h++)(r[h]??0)>u&&(u=r[h]??0,l=h);return{label:n?.labels?.[l]??this.labels[l]??`class_${l}`,score:u}}},K=class extends H{constructor(t){super(t,ke)}async analyze(t,e){return this.run(t,e)}};function wn(o={}){return new H({task:"text-classification",model:o.model??"default",runtime:o.runtime,cache:o.cache??!0,quantization:o.quantization})}function xn(o={}){return new K({task:"sentiment-analysis",model:o.model??"default",runtime:o.runtime,cache:o.cache??!0,quantization:o.quantization})}U("text-classification",o=>new H(o));U("sentiment-analysis",o=>new K(o));F();var J=class extends v{constructor(e,n=768){super(e);f(this,"tokenizer",null);f(this,"embeddingDim");this.embeddingDim=n}async initialize(){await super.initialize(),this.tokenizer||(this.tokenizer=ue())}async run(e,n){let s=Array.isArray(e),i=s?e:[e];await this.initialize();let r=performance.now(),a=[];for(let l of i){let u=await this.preprocess(l),d=await this.runInference(u),h=await this.postprocess(d,n);a.push(h)}let c=performance.now()-r;for(let l of a)l.processingTime=c/a.length;return s?a:a[0]}async preprocess(e){let n=Array.isArray(e)?e[0]:e,s=this.tokenizer.encode(n,{maxLength:128,padding:"max_length",truncation:!0}),i=new g(new Float32Array(s.inputIds),[1,s.inputIds.length],"float32"),r=new g(new Float32Array(s.attentionMask),[1,s.attentionMask.length],"float32");return[i,r]}async runInference(e){let n=e[0]?.shape[1]??128,s=new Float32Array(n*this.embeddingDim),i=e[0]?.toFloat32Array()??new Float32Array(0);for(let r=0;r<n;r++)for(let a=0;a<this.embeddingDim;a++){let c=i[r]??0;s[r*this.embeddingDim+a]=Math.sin(c*(a+1)*.01)*.1}return[new g(s,[1,n,this.embeddingDim],"float32")]}async postprocess(e,n){let s=e[0];if(!s)return{embeddings:[]};let i=n?.pooling??"mean",r=n?.normalize??!0,a;switch(i){case"cls":a=this.extractCLSEmbedding(s);break;case"max":a=this.maxPooling(s);break;case"none":a=s.toArray();break;case"mean":default:a=this.meanPooling(s);break}return r&&(a=this.normalizeVector(a)),n?.outputDim&&n.outputDim<a.length&&(a=a.slice(0,n.outputDim)),{embeddings:a}}extractCLSEmbedding(e){let n=e.toFloat32Array(),s=e.shape[2]??this.embeddingDim;return Array.from(n.slice(0,s))}meanPooling(e){let n=e.toFloat32Array(),s=e.shape[1]??1,i=e.shape[2]??this.embeddingDim,r=new Float32Array(i);for(let a=0;a<s;a++)for(let c=0;c<i;c++)r[c]=(r[c]??0)+(n[a*i+c]??0)/s;return Array.from(r)}maxPooling(e){let n=e.toFloat32Array(),s=e.shape[1]??1,i=e.shape[2]??this.embeddingDim,r=new Array(i).fill(-1/0);for(let a=0;a<s;a++)for(let c=0;c<i;c++){let l=n[a*i+c]??0;l>(r[c]??-1/0)&&(r[c]=l)}return r}normalizeVector(e){let n=0;for(let s of e)n+=s*s;return n=Math.sqrt(n),n===0?e:e.map(s=>s/n)}};function Tn(o={}){return new J({task:"feature-extraction",model:o.model??"default",runtime:o.runtime,cache:o.cache??!0,quantization:o.quantization})}U("feature-extraction",o=>new J(o));F();F();var At={width:224,height:224,resizeMode:"cover",mean:[.485,.456,.406],std:[.229,.224,.225],rescaleFactor:1/255,grayscale:!1,channelFormat:"CHW",dtype:"float32",doResize:!0,doRescale:!0,doNormalize:!0,doCenterCrop:!1,paddingColor:[0,0,0]},oe=class o{constructor(t={}){f(this,"options");f(this,"canvas",null);f(this,"ctx",null);let e=t.size,n=t.width??e??At.width,s=t.height??e??At.height;this.options={...At,...t,width:n,height:s,size:e??n,cropSize:t.cropSize??t.size??n}}static fromConfig(t){let e={},n=t.size;if(n!==void 0){if(typeof n=="number")e.size=n;else if(typeof n=="object"&&n!==null){let h=n;e.width=h.width??h.shortest_edge,e.height=h.height??h.shortest_edge}}let s=t.crop_size;if(s!==void 0){if(typeof s=="number")e.cropSize=s;else if(typeof s=="object"&&s!==null){let h=s;e.cropSize={width:h.width??224,height:h.height??224}}}let i=t.image_mean;Array.isArray(i)&&(e.mean=i);let r=t.image_std;Array.isArray(r)&&(e.std=r);let a=t.rescale_factor;typeof a=="number"&&(e.rescaleFactor=a);let c=t.do_resize;typeof c=="boolean"&&(e.doResize=c);let l=t.do_rescale;typeof l=="boolean"&&(e.doRescale=l);let u=t.do_normalize;typeof u=="boolean"&&(e.doNormalize=u);let d=t.do_center_crop;return typeof d=="boolean"&&(e.doCenterCrop=d),t.resample!==void 0&&(e.resizeMode="cover"),new o(e)}static async fromUrl(t){let e=await fetch(t);if(!e.ok)throw new Error(`Failed to load preprocessor config from ${t}`);let n=await e.json();return o.fromConfig(n)}static async fromHuggingFace(t,e){let n=e?.revision??"main",s=`https://huggingface.co/${t}/resolve/${n}/preprocessor_config.json`;return o.fromUrl(s)}ensureCanvas(){if(!this.canvas)if(typeof document<"u")this.canvas=document.createElement("canvas"),this.ctx=this.canvas.getContext("2d");else throw new Error("ImagePreprocessor requires a browser environment")}async process(t){let e;typeof t=="string"?e=await this.loadFromUrl(t):t instanceof Blob||t instanceof File?e=await this.loadFromBlob(t):t instanceof ImageData?e=t:e=this.toImageData(t);let n=e;return this.options.doResize&&(n=this.resize(n)),this.options.doCenterCrop&&(n=this.centerCrop(n)),this.toTensor(n)}async processBatch(t){let e=await Promise.all(t.map(l=>this.process(l))),n=e.length,s=e[0];if(!s)return new g(new Float32Array(0),[0],"float32");let i=s.shape[0]??3,r=s.shape[1]??this.options.height,a=s.shape[2]??this.options.width,c=new Float32Array(n*i*r*a);for(let l=0;l<e.length;l++){let u=e[l];u&&c.set(u.toFloat32Array(),l*i*r*a)}return new g(c,[n,i,r,a],"float32")}async loadFromUrl(t){return new Promise((e,n)=>{let s=new Image;s.crossOrigin="anonymous",s.onload=()=>{e(this.toImageData(s))},s.onerror=()=>{n(new Error(`Failed to load image from ${t}`))},s.src=t})}async loadFromBlob(t){let e=URL.createObjectURL(t);try{return await this.loadFromUrl(e)}finally{URL.revokeObjectURL(e)}}centerCrop(t){let e=this.options.cropSize,n,s;typeof e=="number"?(n=e,s=e):(n=e.width,s=e.height);let i=Math.max(0,Math.floor((t.width-n)/2)),r=Math.max(0,Math.floor((t.height-s)/2));this.ensureCanvas();let a=document.createElement("canvas");return a.width=t.width,a.height=t.height,a.getContext("2d").putImageData(t,0,0),this.canvas.width=n,this.canvas.height=s,this.ctx.drawImage(a,i,r,n,s,0,0,n,s),this.ctx.getImageData(0,0,n,s)}toImageData(t){this.ensureCanvas();let{width:e,height:n}=t;return this.canvas.width=e,this.canvas.height=n,this.ctx.drawImage(t,0,0),this.ctx.getImageData(0,0,e,n)}resize(t){let{width:e,height:n,resizeMode:s}=this.options;this.ensureCanvas();let i=0,r=0,a=t.width,c=t.height,l=0,u=0,d=e,h=n;if(s==="contain"){let y=Math.min(e/t.width,n/t.height);d=Math.round(t.width*y),h=Math.round(t.height*y),l=Math.round((e-d)/2),u=Math.round((n-h)/2)}else if(s==="cover"){let y=Math.max(e/t.width,n/t.height);a=Math.round(e/y),c=Math.round(n/y),i=Math.round((t.width-a)/2),r=Math.round((t.height-c)/2)}let p=document.createElement("canvas");return p.width=t.width,p.height=t.height,p.getContext("2d").putImageData(t,0,0),this.canvas.width=e,this.canvas.height=n,(s==="contain"||s==="pad")&&(this.ctx.fillStyle="black",this.ctx.fillRect(0,0,e,n)),this.ctx.drawImage(p,i,r,a,c,l,u,d,h),this.ctx.getImageData(0,0,e,n)}toTensor(t){let{mean:e,std:n,grayscale:s,channelFormat:i,dtype:r,doRescale:a,rescaleFactor:c,doNormalize:l}=this.options,u=t.height,d=t.width,h=s?1:3,p=new Float32Array(h*u*d),m=t.data;for(let w=0;w<u;w++)for(let k=0;k<d;k++){let T=(w*d+k)*4;if(s){let b=.299*(m[T]??0)+.587*(m[T+1]??0)+.114*(m[T+2]??0);a&&(b*=c),l&&(b=(b-(e[0]??0))/(n[0]??1));let I=w*d+k;p[I]=b}else if(i==="CHW")for(let b=0;b<3;b++){let I=m[T+b]??0;a&&(I*=c),l&&(I=(I-(e[b]??0))/(n[b]??1));let S=b*u*d+w*d+k;p[S]=I}else for(let b=0;b<3;b++){let I=m[T+b]??0;a&&(I*=c),l&&(I=(I-(e[b]??0))/(n[b]??1));let S=w*d*3+k*3+b;p[S]=I}}let y=i==="CHW"?[h,u,d]:[u,d,h];return new g(p,y,r)}getOptions(){return{...this.options}}},Is={sampleRate:16e3,nMels:80,nFft:400,hopLength:160,normalize:!0,maxDuration:30},ie=class o{constructor(t={}){f(this,"options");f(this,"audioContext",null);this.options={...Is,...t}}static fromConfig(t){let e={},n=t.sampling_rate;typeof n=="number"&&(e.sampleRate=n);let s=t.feature_size;typeof s=="number"&&(e.nMels=s);let i=t.n_fft;typeof i=="number"&&(e.nFft=i);let r=t.hop_length;return typeof r=="number"&&(e.hopLength=r),new o(e)}static async fromHuggingFace(t,e){let n=e?.revision??"main",s=`https://huggingface.co/${t}/resolve/${n}/preprocessor_config.json`,i=await fetch(s);if(!i.ok)throw new Error(`Failed to load audio config from ${s}`);let r=await i.json();return o.fromConfig(r)}ensureAudioContext(){if(!this.audioContext)if(typeof AudioContext<"u")this.audioContext=new AudioContext({sampleRate:this.options.sampleRate});else throw new Error("AudioPreprocessor requires Web Audio API support")}async process(t){let e;typeof t=="string"?e=await this.loadFromUrl(t):t instanceof Blob||t instanceof File?e=await this.loadFromBlob(t):t instanceof AudioBuffer?e=this.audioBufferToFloat32(t):t instanceof Float32Array?e=t:e=await this.decodeAudioData(t),this.options.normalize&&(e=this.normalizeAudio(e));let n=this.options.maxDuration*this.options.sampleRate;return e.length>n&&(e=e.slice(0,n)),this.computeMelSpectrogram(e)}async processRaw(t){let e;typeof t=="string"?e=await this.loadFromUrl(t):t instanceof Blob||t instanceof File?e=await this.loadFromBlob(t):t instanceof AudioBuffer?e=this.audioBufferToFloat32(t):t instanceof Float32Array?e=t:e=await this.decodeAudioData(t),this.options.normalize&&(e=this.normalizeAudio(e));let n=this.options.maxDuration*this.options.sampleRate;return e.length>n&&(e=e.slice(0,n)),new g(e,[1,e.length],"float32")}async loadFromUrl(t){let e=await fetch(t);if(!e.ok)throw new Error(`Failed to load audio from ${t}`);let n=await e.arrayBuffer();return this.decodeAudioData(n)}async loadFromBlob(t){let e=await t.arrayBuffer();return this.decodeAudioData(e)}async decodeAudioData(t){this.ensureAudioContext();let e=await this.audioContext.decodeAudioData(t.slice(0));return this.audioBufferToFloat32(e)}audioBufferToFloat32(t){let e=t.getChannelData(0);return new Float32Array(e)}normalizeAudio(t){let e=0;for(let n=0;n<t.length;n++){let s=Math.abs(t[n]??0);s>e&&(e=s)}if(e>0){let n=new Float32Array(t.length);for(let s=0;s<t.length;s++)n[s]=(t[s]??0)/e;return n}return t}computeMelSpectrogram(t){let{nMels:e,nFft:n,hopLength:s}=this.options,i=Math.floor((t.length-n)/s)+1;if(i<=0)return new g(new Float32Array(e),[1,e],"float32");let r=new Float32Array(i*e);for(let a=0;a<i;a++){let c=a*s;for(let l=0;l<e;l++){let u=0,d=Math.floor(l/e*(n/2)),h=Math.floor((l+1)/e*(n/2));for(let p=d;p<Math.min(h,n);p++){let m=t[c+p]??0;u+=m*m}r[a*e+l]=Math.log(u+1e-10)}}return new g(r,[i,e],"float32")}dispose(){this.audioContext&&(this.audioContext.close(),this.audioContext=null)}};function bn(o,t={}){let{lowercase:e=!0,removePunctuation:n=!1,normalizeWhitespace:s=!0,maxLength:i}=t,r=o;return e&&(r=r.toLowerCase()),n&&(r=r.replace(/[^\w\s]/g,"")),s&&(r=r.replace(/\s+/g," ").trim()),i&&r.length>i&&(r=r.slice(0,i)),r}function qe(o="imagenet",t={}){let e={imagenet:{width:224,height:224,mean:[.485,.456,.406],std:[.229,.224,.225]},clip:{width:224,height:224,mean:[.48145466,.4578275,.40821073],std:[.26862954,.26130258,.27577711]},vit:{width:224,height:224,mean:[.5,.5,.5],std:[.5,.5,.5]},custom:{}};return new oe({...e[o],...t})}function Mn(o="whisper",t={}){let e={whisper:{sampleRate:16e3,nMels:80,nFft:400,hopLength:160},wav2vec:{sampleRate:16e3,normalize:!0},custom:{}};return new ie({...e[o],...t})}var Y=class extends v{constructor(e,n,s=1e3){super(e);f(this,"preprocessor",null);f(this,"labels");f(this,"numClasses");this.labels=n??Be,this.numClasses=s}async initialize(){await super.initialize(),this.preprocessor||(this.preprocessor=qe("imagenet"))}setLabels(e){this.labels=e,this.numClasses=e.length}async run(e,n){let s=Array.isArray(e),i=s?e:[e];await this.initialize();let r=performance.now(),a=[];for(let l of i){let u=await this.preprocess(l),d=await this.runInference(u),h=await this.postprocess(d,n);a.push(h)}let c=performance.now()-r;for(let l of a)l.processingTime=c/a.length;return s?a:a[0]}async preprocess(e){let n=Array.isArray(e)?e[0]:e,s=await this.preprocessor.process(n);return s.shape.length===3?[s.reshape([1,...s.shape])]:[s]}async runInference(e){let n=new Float32Array(this.numClasses),s=e[0]?.toFloat32Array()??new Float32Array(0),i=0;for(let r=0;r<Math.min(1e3,s.length);r++)i+=s[r]??0;for(let r=0;r<this.numClasses;r++)n[r]=Math.sin(i*(r+1)*.1)*3;return[new g(n,[1,this.numClasses],"float32")]}async postprocess(e,n){let s=e[0];if(!s)return{label:"unknown",score:0};let r=L(s,-1).toFloat32Array();(n?.topK??1)>1||n?.returnAllScores;let c=0,l=r[0]??0;for(let d=1;d<r.length;d++)(r[d]??0)>l&&(l=r[d]??0,c=d);return{label:n?.labels?.[c]??this.labels[c]??`class_${c}`,score:l}}};function kn(o={},t){return new Y({task:"image-classification",model:o.model??"default",runtime:o.runtime,cache:o.cache??!0,quantization:o.quantization},t)}U("image-classification",o=>new Y(o));F();var je=class extends v{constructor(e){super(e??{task:"text-generation",model:"default"});f(this,"tokenizer",null);f(this,"eosTokenId",50256)}setTokenizer(e){this.tokenizer=e;let n=e.getSpecialTokenIds();this.eosTokenId=n.eosTokenId??n.sepTokenId??50256}async preprocess(e){let n=Array.isArray(e)?e[0]??"":e;if(!this.tokenizer)return[new g(new Float32Array([0]),[1],"float32")];let s=this.tokenizer.encode(n,{addSpecialTokens:!1,padding:"do_not_pad"});return[new g(BigInt64Array.from(s.inputIds.map(i=>BigInt(i))),[1,s.inputIds.length],"int64")]}async postprocess(e,n){return{generatedText:"",tokenIds:[],numTokens:0,processingTime:0}}async run(e,n){await this.initialize();let s=Array.isArray(e)?e:[e],i=await Promise.all(s.map(r=>this.generateSingle(r,n??{})));return Array.isArray(e)?i:i[0]}async*stream(e,n={}){let s=performance.now();if(!this.tokenizer)throw new Error("Tokenizer not set. Call setTokenizer() first.");let{maxNewTokens:i=50,maxLength:r=512,temperature:a=1,topK:c=0,topP:l=1,repetitionPenalty:u=1,stopSequences:d=[],doSample:h=!0}=n,m=[...this.tokenizer.encode(e,{addSpecialTokens:!1,padding:"do_not_pad",truncation:!1}).inputIds],y=[],w="";for(let T=0;T<i&&!(m.length>=r);T++){let b=await this.generateNextToken(m,a,c,l,u,h);if(b===this.eosTokenId){yield{token:"",tokenId:b,generatedText:w,done:!0};break}let I=this.tokenizer.decode([b],!0);y.push(b),m.push(b),w+=I,n.onToken&&n.onToken(I,b);let S=!1;for(let P of d)if(w.endsWith(P)){w=w.slice(0,-P.length),S=!0;break}if(yield{token:I,tokenId:b,generatedText:w,done:S},S)break}let k=performance.now();console.log(`Generation completed in ${(k-s).toFixed(2)}ms`)}async generateSingle(e,n){let s=performance.now();if(!this.tokenizer)throw new Error("Tokenizer not set. Call setTokenizer() first.");let{maxNewTokens:i=50,maxLength:r=512,temperature:a=1,topK:c=0,topP:l=1,repetitionPenalty:u=1,stopSequences:d=[],doSample:h=!0,returnFullText:p=!1}=n,y=[...this.tokenizer.encode(e,{addSpecialTokens:!1,padding:"do_not_pad",truncation:!1}).inputIds],w=[];for(let b=0;b<i&&!(y.length>=r);b++){let I=await this.generateNextToken(y,a,c,l,u,h);if(I===this.eosTokenId)break;if(w.push(I),y.push(I),n.onToken){let E=this.tokenizer.decode([I],!0);n.onToken(E,I)}let S=this.tokenizer.decode(w,!0),P=!1;for(let E of d)if(S.endsWith(E)){P=!0;break}if(P)break}let k=this.tokenizer.decode(w,!0),T=performance.now();return{generatedText:k,fullText:p?e+k:void 0,tokenIds:w,numTokens:w.length,processingTime:T-s}}async generateNextToken(e,n,s,i,r,a){if(!this.model)throw new Error("Model not loaded");let c=new g(BigInt64Array.from(e.map(T=>BigInt(T))),[1,e.length],"int64"),l=new g(BigInt64Array.from(e.map(()=>BigInt(1))),[1,e.length],"int64"),u=await re(this.model,[c,l]);if(!u||u.length===0)throw new Error("Model returned no outputs");let d=u[0],h=d.toFloat32Array(),p=d.shape[d.shape.length-1]??50257,m=new Float32Array(p),y=(e.length-1)*p;for(let T=0;T<p;T++)m[T]=h[y+T]??0;if(r!==1){for(let T of e)if(T<p){let b=m[T]??0;m[T]=b>0?b/r:b*r}}if(n!==1)for(let T=0;T<p;T++)m[T]=(m[T]??0)/n;let w=new g(m,[p],"float32"),k=L(w).toFloat32Array();return a?this.sample(k,s,i):this.greedy(k)}greedy(e){let n=0,s=e[0]??0;for(let i=1;i<e.length;i++)(e[i]??0)>s&&(s=e[i]??0,n=i);return n}sample(e,n,s){let i=Array.from({length:e.length},(u,d)=>d);i.sort((u,d)=>(e[d]??0)-(e[u]??0));let r=i;if(n>0&&n<e.length&&(r=i.slice(0,n)),s<1){let u=0,d=[];for(let h of r)if(d.push(h),u+=e[h]??0,u>=s)break;r=d}let a=0;for(let u of r)a+=e[u]??0;let c=Math.random()*a,l=0;for(let u of r)if(l+=e[u]??0,l>=c)return u;return r[0]??0}};F();Ce();C();var Ss="https://huggingface.co",zs="main",An=["model.onnx","model_quantized.onnx","model_int8.onnx","model_uint8.onnx","model_fp16.onnx","onnx/model.onnx","onnx/model_quantized.onnx"];function We(o,t,e={}){let n=e.endpoint??Ss,s=e.revision??zs,i=e.subfolder?`${e.subfolder}/`:"";return`${n}/${o}/resolve/${s}/${i}${t}`}async function In(o,t){let e={};return t&&(e.Authorization=`Bearer ${t}`),await fetch(o,{headers:e})}async function Sn(o,t,e={}){let n=We(o,t,e);try{let s=await In(n,e.token);return s.ok||s.status===302}catch{return!1}}async function It(o,t={}){for(let e of An)if(await Sn(o,e,t))return e;return null}async function zn(o,t,e={}){let n=We(o,t,e);return V(n,{cache:e.cache??!0,forceDownload:e.forceDownload??!1,onProgress:e.onProgress?s=>{e.onProgress({file:t,fileIndex:1,totalFiles:1,fileProgress:s,overallProgress:s.percent})}:void 0})}async function vs(o,t,e={}){let n=We(o,t,e);if(e.cache!==!1&&!e.forceDownload&&await ge(n)){let r=await V(n,{cache:!0}),a=new TextDecoder().decode(r);return JSON.parse(a)}let s=await In(n,e.token);if(!s.ok)throw new x(`Failed to download ${t} from ${o}: ${s.status}`,M.MODEL_NOT_FOUND);return s.json()}async function St(o,t={}){let e=We(o,"tokenizer.json",t),n=await V(e,{cache:t.cache??!0,forceDownload:t.forceDownload??!1,onProgress:t.onProgress?i=>{t.onProgress({file:"tokenizer.json",fileIndex:1,totalFiles:1,fileProgress:i,overallProgress:i.percent})}:void 0}),s=new TextDecoder().decode(n);return W.fromJSON(s)}async function He(o,t={}){return vs(o,"config.json",t)}async function Ve(o,t={}){let e={},s=0,i=(u,d)=>{if(t.onProgress){let h=s/3*100,p=d.percent/3;t.onProgress({file:u,fileIndex:s+1,totalFiles:3,fileProgress:d,overallProgress:h+p})}};console.log(`\u{1F50D} Finding ONNX model in ${o}...`);let r=await It(o,t);if(!r)throw new x(`No ONNX model found in ${o}. Please ensure the model has an ONNX file.`,M.MODEL_NOT_FOUND,{modelId:o,triedFiles:An});e.model=r,console.log(`\u{1F4E6} Downloading model: ${r}`);let a=await zn(o,r,{...t,onProgress:u=>i(r,u.fileProgress)});s=1;let c;try{console.log("\u{1F4DD} Downloading tokenizer..."),e.tokenizer="tokenizer.json",c=await St(o,t),console.log("\u2713 Tokenizer loaded")}catch{console.warn(`\u26A0\uFE0F No tokenizer found for ${o}`)}s=2;let l;try{console.log("\u2699\uFE0F Downloading config..."),e.config="config.json",l=await He(o,t),console.log("\u2713 Config loaded")}catch{console.warn(`\u26A0\uFE0F No config found for ${o}`)}return s=3,t.onProgress&&t.onProgress({file:"complete",fileIndex:3,totalFiles:3,fileProgress:{loaded:1,total:1,percent:100,speed:0,eta:0},overallProgress:100}),console.log(`\u2705 Model bundle downloaded: ${o}`),{modelId:o,modelData:a,tokenizer:c,config:l,files:e}}async function Ge(o,t={}){return Ve(o,t)}async function vn(o,t={}){try{return await It(o,t)!==null}catch{return!1}}async function En(o,t={}){let[e,n,s]=await Promise.all([It(o,t),Sn(o,"tokenizer.json",t),He(o,t).catch(()=>{})]);return{hasOnnx:e!==null,onnxFile:e??void 0,hasTokenizer:n,hasConfig:s!==void 0,config:s}}var zt={"sentiment-analysis":"Xenova/distilbert-base-uncased-finetuned-sst-2-english","text-classification":"Xenova/distilbert-base-uncased-finetuned-sst-2-english","feature-extraction":"Xenova/all-MiniLM-L6-v2","sentence-similarity":"Xenova/all-MiniLM-L6-v2","question-answering":"Xenova/distilbert-base-cased-distilled-squad",ner:"Xenova/bert-base-NER","token-classification":"Xenova/bert-base-NER","text-generation":"Xenova/gpt2","translation-en-fr":"Xenova/t5-small","translation-en-de":"Xenova/t5-small",summarization:"Xenova/distilbart-cnn-6-6","fill-mask":"Xenova/bert-base-uncased","image-classification":"Xenova/vit-base-patch16-224","object-detection":"Xenova/detr-resnet-50","image-segmentation":"Xenova/segformer-b0-finetuned-ade-512-512","zero-shot-classification":"Xenova/mobilebert-uncased-mnli","automatic-speech-recognition":"Xenova/whisper-tiny.en","text-to-speech":"Xenova/speecht5_tts"};function vt(o){return zt[o]}async function Xe(o,t={}){let e=vt(o);return Ve(e,t)}var Ae=class o extends v{constructor(e){super(e);f(this,"tokenizer",null);f(this,"id2label",[]);f(this,"injectedModel",null)}static fromLoadedModel(e,n,s,i={runtime:e.runtime,cache:!0}){let r=new o({task:"token-classification",model:"injected",runtime:i.runtime,cache:i.cache??!0,quantization:i.quantization});return r.injectedModel=e,r.model=e,r.tokenizer=n,r.id2label=s,r.isReady=!0,r}async initialize(){if(this.isReady&&this.model&&this.tokenizer)return;if(this.injectedModel&&this.tokenizer){this.model=this.injectedModel,this.isReady=!0;return}let e=this.config.model,n=e==="default"?await Xe("token-classification",{cache:this.config.cache??!0}):await Ge(e,{cache:this.config.cache??!0});this.tokenizer=n.tokenizer??await Ue(n.modelId);let s=n.config?.id2label;if(s&&typeof s=="object"){let r=Object.entries(s).map(([a,c])=>[Number(a),String(c)]).filter(([a])=>Number.isFinite(a)).sort((a,c)=>a[0]-c[0]);this.id2label=r.map(([,a])=>a)}else this.id2label=["O","B-PER","I-PER","B-ORG","I-ORG","B-LOC","I-LOC","B-MISC","I-MISC"];let i=this.config.runtime&&this.config.runtime!=="auto"?this.config.runtime:"wasm";this.model=await Mt(n.modelData,{runtime:i,quantization:this.config.quantization,cache:this.config.cache,metadata:{name:n.modelId}}),this.isReady=!0}async run(e,n){await this.initialize();let s=n?.threshold??.5,i=n?.entityTypes?new Set(n.entityTypes):null,r=n?.maxLength??128,a=this.tokenizer.encode(e,{maxLength:r,padding:"max_length",truncation:!0,returnTokenTypeIds:!0}),c=new g(a.inputIds,[1,a.inputIds.length],"int64"),l=new g(a.attentionMask,[1,a.attentionMask.length],"int64"),u=new g(a.tokenTypeIds??new Array(a.inputIds.length).fill(0),[1,a.inputIds.length],"int64"),d=await re(this.model,[c,l,u]),h=this.postprocessTokenClassification(d,e,a.inputIds);return c.dispose(),l.dispose(),u.dispose(),d.forEach(p=>p.dispose()),h.filter(p=>p.score>=s).filter(p=>i?i.has(p.entity):!0)}async preprocess(){throw new Error("TokenClassificationPipeline.preprocess is not used")}async postprocess(){throw new Error("TokenClassificationPipeline.postprocess is not used")}postprocessTokenClassification(e,n,s){let i=e[0];if(!i)return[];let r=i.shape,a=r[1]??s.length,c=r[2]??this.id2label.length,l=i.toFloat32Array(),u=this.alignOffsets(n,s,a),d=[];for(let p=0;p<a;p++){let m=this.tokenizer.getToken(s[p]??-1)??"",y=u[p];if(!y)continue;let[w,k]=y,T=p*c,b=0,I=l[T]??-1/0;for(let z=1;z<c;z++){let A=l[T+z]??-1/0;A>I&&(I=A,b=z)}let S=0;for(let z=0;z<c;z++)S+=Math.exp((l[T+z]??-1/0)-I);let P=S>0?1/S:0,E=this.id2label[b]??"O";d.push({token:m,label:E,prob:P,start:w,end:k})}let h=d.filter(p=>p.start!==p.end);return Es(h,n)}alignOffsets(e,n,s){let i=Array.from({length:s},()=>[0,0]),r=0;for(let a=0;a<Math.min(s,n.length);a++){let c=n[a],l=this.tokenizer.getToken(c)??"";if(!l||this.tokenizer.isSpecialToken(l)||l==="[PAD]"||l.startsWith("[")&&l.endsWith("]")){i[a]=[0,0];continue}let u=l.startsWith("##")?l.slice(2):l;if(u=u.replace(/^[\s\u0120\u2581]+/g,""),!u){i[a]=[0,0];continue}let d=e.indexOf(u,r);if(d===-1&&(d=e.toLowerCase().indexOf(u.toLowerCase(),r)),d===-1){let h=e.slice(r).search(/\S/);if(h>=0){let p=r+h;d=e.indexOf(u,p),d===-1&&(d=e.toLowerCase().indexOf(u.toLowerCase(),p))}}if(d===-1){i[a]=[0,0];continue}i[a]=[d,d+u.length],r=d+u.length}return i}};function Es(o,t){let e=[],n=null,s=0,i=0,r=0,a=0,c=()=>{if(!n||s===i)return;let u=t.slice(s,i);e.push({entity:n,word:u,start:s,end:i,score:a?r/a:0}),n=null,s=0,i=0,r=0,a=0},l=u=>u==="PER"||u==="ORG"||u==="LOC"||u==="MISC"?u:null;for(let u of o){let d=u.label;if(!d||d==="O"){c();continue}let h=/^(B|I)-(.+)$/.exec(d);if(!h){c();continue}let p=h[1],m=l(h[2]);if(!m){c();continue}p==="B"||n===null||n!==m||u.start>i+1?(c(),n=m,s=u.start,i=u.end,r=u.prob,a=1):(i=Math.max(i,u.end),r+=u.prob,a+=1)}return c(),e}U("token-classification",o=>new Ae(o));F();var Fs=["person","bicycle","car","motorcycle","airplane","bus","train","truck","boat","traffic light","fire hydrant","stop sign","parking meter","bench","bird","cat","dog","horse","sheep","cow","elephant","bear","zebra","giraffe","backpack","umbrella","handbag","tie","suitcase","frisbee","skis","snowboard","sports ball","kite","baseball bat","baseball glove","skateboard","surfboard","tennis racket","bottle","wine glass","cup","fork","knife","spoon","bowl","banana","apple","sandwich","orange","broccoli","carrot","hot dog","pizza","donut","cake","chair","couch","potted plant","bed","dining table","toilet","tv","laptop","mouse","remote","keyboard","cell phone","microwave","oven","toaster","sink","refrigerator","book","clock","vase","scissors","teddy bear","hair drier","toothbrush"],Qe=class extends v{constructor(e,n){super(e??{task:"object-detection",model:"default"});f(this,"preprocessor");f(this,"labels");this.labels=n??Fs,this.preprocessor=new oe({width:640,height:640,mean:[.485,.456,.406],std:[.229,.224,.225],channelFormat:"CHW"})}setLabels(e){this.labels=e}async preprocess(e){let n=Array.isArray(e)?e:[e];if(n.length===1){let s=await this.preprocessor.process(n[0]);return[new g(s.toFloat32Array(),[1,...s.shape],"float32")]}return[await this.preprocessor.processBatch(n)]}async postprocess(e,n){let s=n??{},i=s.threshold??.5,r=s.topK??100,a=s.nms??!0,c=s.iouThreshold??.5;if(!e[0])return[];let l=e[0].toFloat32Array(),u=[...e[0].shape],d=this.parseDetections(l,u,i),h=a?this.nonMaxSuppression(d,c):d;return h.sort((p,m)=>m.score-p.score),h=h.slice(0,r),h}parseDetections(e,n,s){let i=[],r=n[1]??0,a=n[2]??0;if(a>=5){let c=a-5;for(let l=0;l<r;l++){let u=l*a,d=e[u+4]??0;if(d<s)continue;let h=0,p=0;for(let b=0;b<c;b++){let I=e[u+5+b]??0;I>h&&(h=I,p=b)}let m=d*h;if(m<s)continue;let y=e[u]??0,w=e[u+1]??0,k=e[u+2]??0,T=e[u+3]??0;i.push({label:this.labels[p]??`class_${p}`,score:m,classId:p,box:{x:Math.max(0,y-k/2),y:Math.max(0,w-T/2),width:k,height:T},boxNormalized:{x:Math.max(0,y-k/2),y:Math.max(0,w-T/2),width:k,height:T}})}}else if(a===4)for(let c=0;c<r;c++){let l=c*a,u=e[l]??0,d=e[l+1]??0,h=e[l+2]??0,p=e[l+3]??0;i.push({label:this.labels[0]??"object",score:1,classId:0,box:{x:u,y:d,width:h-u,height:p-d},boxNormalized:{x:u,y:d,width:h-u,height:p-d}})}return i}nonMaxSuppression(e,n){if(e.length===0)return[];let s=[...e].sort((a,c)=>c.score-a.score),i=[],r=new Array(s.length).fill(!0);for(let a=0;a<s.length;a++){if(!r[a])continue;let c=s[a];i.push(c);for(let l=a+1;l<s.length;l++){if(!r[l])continue;let u=s[l];if(c.classId!==u.classId)continue;this.computeIoU(c.box,u.box)>n&&(r[l]=!1)}}return i}computeIoU(e,n){let s=Math.max(0,Math.min(e.x+e.width,n.x+n.width)-Math.max(e.x,n.x)),i=Math.max(0,Math.min(e.y+e.height,n.y+n.height)-Math.max(e.y,n.y)),r=s*i,a=e.width*e.height,c=n.width*n.height,l=a+c-r;return l>0?r/l:0}};F();var Ke=class extends v{constructor(e){super(e??{task:"automatic-speech-recognition",model:"default"});f(this,"audioPreprocessor");f(this,"tokenizer",null);this.audioPreprocessor=new ie({sampleRate:16e3,nMels:80,nFft:400,hopLength:160,maxDuration:30})}setTokenizer(e){this.tokenizer=e}async preprocess(e){let n=Array.isArray(e)?e:[e],s=await Promise.all(n.map(i=>this.audioPreprocessor.process(i)));if(s.length===1){let i=s[0];return[new g(i.toFloat32Array(),[1,...i.shape],"float32")]}return s}async postprocess(e,n){let i=(n??{}).returnTimestamps??!1;if(!e[0])return{text:""};let r=e[0].toFloat32Array(),a=e[0].shape,c=this.decodeOutput(r,a),l={text:c};return i&&(l.chunks=this.extractTimestamps(r,a,c)),l}decodeOutput(e,n){let s=n[1]??e.length,i=n[2]??1,r=[];if(i>1)for(let a=0;a<s;a++){let c=a*i,l=0,u=e[c]??-1/0;for(let d=1;d<i;d++)(e[c+d]??-1/0)>u&&(u=e[c+d]??-1/0,l=d);r.push(l)}else for(let a=0;a<e.length;a++)r.push(Math.round(e[a]??0));return this.tokenizer?this.tokenizer.decode(r,!0):r.join(" ")}extractTimestamps(e,n,s){let i=s.split(/\s+/).filter(u=>u.length>0),r=[],a=2.5,c="",l=0;for(let u=0;u<i.length;u++)if(c+=(c?" ":"")+i[u],(u+1)%5===0||u===i.length-1){let d=c.split(/\s+/).length/a;r.push({text:c,start:l,end:l+d}),l=l+d,c=""}return r}async processLongAudio(e,n={}){let s=n.chunkDuration??30,i=n.chunkOverlap??5,a=(await this.audioPreprocessor.processRaw(e)).toFloat32Array(),c=16e3,l=s*c,u=i*c,d=l-u,h=[];for(let y=0;y<a.length;y+=d){let w=Math.min(y+l,a.length),k=a.slice(y,w),T=await this.run(new Float32Array(k),n);if(T.chunks){let b=y/c;T.chunks=T.chunks.map(I=>({...I,start:I.start+b,end:I.end+b}))}h.push(T)}let p=h.map(y=>y.text).join(" "),m=h.flatMap(y=>y.chunks??[]);return{text:p,chunks:m}}};F();var Je=class extends v{constructor(e){super(e??{task:"zero-shot-classification",model:"default"});f(this,"tokenizer",null);f(this,"hypothesisTemplate","This text is about {label}.")}setTokenizer(e){this.tokenizer=e}async classify(e,n,s){return this.run({text:e,candidateLabels:n},s)}async run(e,n){await this.initialize();let{text:s,candidateLabels:i}=e,r=n??{},a=Array.isArray(s)?s:[s],c=r.hypothesisTemplate??this.hypothesisTemplate,l=r.multiLabel??!1,u=await Promise.all(a.map(d=>this.classifySingle(d,i,c,l)));return Array.isArray(s)?u:u[0]}async classifySingle(e,n,s,i){let r=performance.now(),a=n.map(d=>s.replace("{label}",d)),c=[];for(let d of a){let h=await this.scoreHypothesis(e,d);c.push(h)}let l;if(i)l=c.map(d=>1/(1+Math.exp(-d)));else{let d=new g(new Float32Array(c),[c.length],"float32");l=Array.from(L(d).toFloat32Array())}let u=n.map((d,h)=>({label:d,score:l[h]??0}));return u.sort((d,h)=>h.score-d.score),{sequence:e,labels:u.map(d=>d.label),scores:u.map(d=>d.score),processingTime:performance.now()-r}}async scoreHypothesis(e,n){if(!this.tokenizer)throw new Error("Tokenizer not set. Call setTokenizer() first.");return this.tokenizer.encode(e,{textPair:n,addSpecialTokens:!0,maxLength:512,truncation:!0,returnAttentionMask:!0,returnTokenTypeIds:!0}),Math.random()}async preprocess(e){let{text:n,candidateLabels:s}=e,i=Array.isArray(n)?n[0]??"":n,r=s[0]??"";if(!this.tokenizer)return[new g(new Float32Array([0]),[1],"float32")];let a=this.tokenizer.encode(i,{textPair:this.hypothesisTemplate.replace("{label}",r),addSpecialTokens:!0,maxLength:512});return[new g(BigInt64Array.from(a.inputIds.map(c=>BigInt(c))),[1,a.inputIds.length],"int64")]}async postprocess(e,n){return{sequence:"",labels:[],scores:[]}}};F();var Ye=class extends v{constructor(e){super(e??{task:"question-answering",model:"default"});f(this,"tokenizer",null)}setTokenizer(e){this.tokenizer=e}async run(e,n){await this.initialize();let s=Array.isArray(e)?e:[e],i=await Promise.all(s.map(r=>this.answerQuestion(r,n??{})));return Array.isArray(e)?i:i[0]}async answerQuestion(e,n){let s=performance.now();if(!this.tokenizer)throw new Error("Tokenizer not set. Call setTokenizer() first.");let{question:i,context:r}=e,{maxAnswerLength:a=30}=n,c=this.tokenizer.encode(i,{textPair:r,addSpecialTokens:!0,maxLength:512,truncation:!0,returnAttentionMask:!0,returnTokenTypeIds:!0}),l=this.findBestAnswer(r,i,c.inputIds,a);return{answer:l.text,score:l.score,start:l.start,end:l.end,processingTime:performance.now()-s}}findBestAnswer(e,n,s,i){let r=n.toLowerCase().split(/\s+/),a=e.split(/[.!?]+/).filter(p=>p.trim()),c="",l=0,u=0;for(let p of a){let m=p.toLowerCase().split(/\s+/),y=0;for(let w of r)m.some(k=>k.includes(w)||w.includes(k))&&(y+=1);y>l&&(l=y,c=p.trim(),u=e.indexOf(p.trim()))}let d=c.split(/\s+/);d.length>i&&(c=d.slice(0,i).join(" "));let h=r.length>0?l/r.length:0;return{text:c||"No answer found",score:Math.min(h,1),start:u>=0?u:0,end:u>=0?u+c.length:0}}async preprocess(e){if(!this.tokenizer)return[new g(new Float32Array([0]),[1],"float32")];let n=Array.isArray(e)?e[0]:e,s=this.tokenizer.encode(n.question,{textPair:n.context,addSpecialTokens:!0,maxLength:512,truncation:!0,returnAttentionMask:!0,returnTokenTypeIds:!0});return[new g(BigInt64Array.from(s.inputIds.map(i=>BigInt(i))),[1,s.inputIds.length],"int64"),new g(BigInt64Array.from(s.attentionMask.map(i=>BigInt(i))),[1,s.attentionMask.length],"int64")]}async postprocess(e,n){if(e.length<2)return{answer:"",score:0,start:0,end:0};let s=e[0].toFloat32Array(),i=e[1].toFloat32Array(),r=s.length,a=L(new g(s,[r],"float32")).toFloat32Array(),c=L(new g(i,[r],"float32")).toFloat32Array(),l=0,u=0,d=0;for(let h=0;h<r;h++)for(let p=h;p<Math.min(h+30,r);p++){let m=(a[h]??0)*(c[p]??0);m>d&&(d=m,l=h,u=p)}return{answer:"",score:d,start:l,end:u}}};async function Fn(o,t){let e={task:o,model:t?.model??"default",runtime:t?.runtime,cache:t?.cache??!0,quantization:t?.quantization},n;switch(o){case"text-classification":n=new H(e,t?.labels);break;case"token-classification":n=new Ae(e);break;case"sentiment-analysis":n=new K(e);break;case"feature-extraction":n=new J(e);break;case"image-classification":n=new Y(e,t?.labels);break;case"text-generation":n=new je(e);break;case"object-detection":n=new Qe(e,t?.labels);break;case"automatic-speech-recognition":n=new Ke(e);break;case"zero-shot-classification":n=new Je(e);break;case"question-answering":n=new Ye(e);break;default:throw new Error(`Unknown pipeline task: ${o}`)}return await n.initialize(),n}async function Ps(o,t){let e=await Promise.all(o.map(s=>Fn(s,t))),n={};for(let s=0;s<o.length;s++){let i=o[s];n[i]=e[s]}return n}Ce();async function Ie(o,t={}){let{warmupRuns:e=3,runs:n=10,verbose:s=!1,timeout:i=3e4,name:r="benchmark"}=t,a=[],c=0;s&&console.log(`[${r}] Running ${e} warmup iterations...`);for(let y=0;y<e;y++)try{await Promise.race([Promise.resolve(o()),new Promise((w,k)=>setTimeout(()=>k(new Error("Timeout")),i))])}catch{}s&&console.log(`[${r}] Running ${n} measured iterations...`);for(let y=0;y<n;y++)try{let w=performance.now();await Promise.race([Promise.resolve(o()),new Promise((T,b)=>setTimeout(()=>b(new Error("Timeout")),i))]);let k=performance.now();a.push(k-w),s&&console.log(`  Run ${y+1}: ${(k-w).toFixed(2)}ms`)}catch(w){c++,s&&console.log(`  Run ${y+1}: FAILED - ${w}`)}if(a.length===0)throw new Error(`All ${n} runs failed`);let l=[...a].sort((y,w)=>y-w),d=a.reduce((y,w)=>y+w,0)/a.length,h=a.reduce((y,w)=>y+Math.pow(w-d,2),0)/a.length,p=Math.sqrt(h),m={name:r,avgTime:d,medianTime:l[Math.floor(l.length/2)]??0,minTime:l[0]??0,maxTime:l[l.length-1]??0,stdDev:p,p95:l[Math.floor(l.length*.95)]??l[l.length-1]??0,p99:l[Math.floor(l.length*.99)]??l[l.length-1]??0,throughput:1e3/d,times:a,totalRuns:n,failedRuns:c};return s&&(console.log(`
[${r}] Results:`),console.log(`  Avg: ${m.avgTime.toFixed(2)}ms`),console.log(`  Median: ${m.medianTime.toFixed(2)}ms`),console.log(`  Min: ${m.minTime.toFixed(2)}ms`),console.log(`  Max: ${m.maxTime.toFixed(2)}ms`),console.log(`  Std Dev: ${m.stdDev.toFixed(2)}ms`),console.log(`  P95: ${m.p95.toFixed(2)}ms`),console.log(`  Throughput: ${m.throughput.toFixed(2)} ops/sec`)),m}async function Pn(o,t,e={}){let n=await Ie(o,{...e,name:e.name?`${e.name} (baseline)`:"baseline"}),s=await Ie(t,{...e,name:e.name?`${e.name} (comparison)`:"comparison"}),i=n.avgTime/s.avgTime,r=(n.avgTime-s.avgTime)/n.avgTime*100,a;return Math.abs(r)<5?a="tie":r>0?a="comparison":a="baseline",{baseline:n,comparison:s,speedup:i,percentFaster:r,winner:a}}async function Dn(o,t={}){let e={};for(let[n,s]of Object.entries(o))console.log(`
=== ${n} ===`),e[n]=await Ie(s,{...t,name:n,verbose:!0});return e}function Ln(o){return`
\u250C\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510
\u2502 ${o.name.padEnd(39)} \u2502
\u251C\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524
\u2502 Avg Time:    ${o.avgTime.toFixed(2).padStart(10)}ms             \u2502
\u2502 Median:      ${o.medianTime.toFixed(2).padStart(10)}ms             \u2502
\u2502 Min Time:    ${o.minTime.toFixed(2).padStart(10)}ms             \u2502
\u2502 Max Time:    ${o.maxTime.toFixed(2).padStart(10)}ms             \u2502
\u2502 Std Dev:     ${o.stdDev.toFixed(2).padStart(10)}ms             \u2502
\u2502 P95:         ${o.p95.toFixed(2).padStart(10)}ms             \u2502
\u2502 P99:         ${o.p99.toFixed(2).padStart(10)}ms             \u2502
\u2502 Throughput:  ${o.throughput.toFixed(2).padStart(10)} ops/sec     \u2502
\u2502 Runs:        ${o.totalRuns.toString().padStart(10)} (${o.failedRuns} failed)  \u2502
\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518
  `.trim()}function _n(o){let t=o.percentFaster>0?"\u2191":o.percentFaster<0?"\u2193":"=",e=o.winner==="comparison"?"Comparison is faster!":o.winner==="baseline"?"Baseline is faster!":"Results are similar";return`
\u250C\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510
\u2502                  BENCHMARK COMPARISON               \u2502
\u251C\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524
\u2502 Baseline:    ${o.baseline.avgTime.toFixed(2).padStart(10)}ms                       \u2502
\u2502 Comparison:  ${o.comparison.avgTime.toFixed(2).padStart(10)}ms                       \u2502
\u251C\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524
\u2502 Speedup:     ${o.speedup.toFixed(2).padStart(10)}x                        \u2502
\u2502 Difference:  ${t} ${Math.abs(o.percentFaster).toFixed(1).padStart(8)}%                      \u2502
\u251C\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524
\u2502 Winner: ${e.padEnd(42)} \u2502
\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518
  `.trim()}async function Cn(o,t={}){let{name:e="memory-benchmark",runs:n=5}=t,s=()=>typeof performance<"u"&&"memory"in performance?performance.memory.usedJSHeapSize:0,i=[],r=s();for(let u=0;u<n;u++)await o(),i.push(s());let a=Math.max(...i),c=i.reduce((u,d)=>u+d,0)/i.length,l=c-r;return{name:e,peakMemory:a,avgMemory:c,memoryDelta:l}}C();F();function Nn(o,t,e,n,s=0,i=[]){let r=e?-(1<<t-1):0,a=e?(1<<t-1)-1:(1<<t)-1;if(n&&i.length>1){let c=i[s]??1,l=new Float32Array(c),u=new Int32Array(c),d=o.length/c,h=1/0,p=-1/0;for(let m=0;m<c;m++){let y=1/0,w=-1/0;for(let k=0;k<d;k++){let T=m*d+k,b=o[T]??0;y=Math.min(y,b),w=Math.max(w,b)}if(h=Math.min(h,y),p=Math.max(p,w),e){let k=Math.max(Math.abs(y),Math.abs(w));l[m]=k/a,u[m]=0}else l[m]=(w-y)/(a-r),u[m]=Math.round(r-y/(l[m]||1));l[m]===0&&(l[m]=1)}return{scale:l,zeroPoint:u,min:h,max:p}}else{let c=1/0,l=-1/0;for(let h=0;h<o.length;h++){let p=o[h]??0;c=Math.min(c,p),l=Math.max(l,p)}let u,d;return e?(u=Math.max(Math.abs(c),Math.abs(l))/a,d=0):(u=(l-c)/(a-r),d=Math.round(r-c/(u||1))),u===0&&(u=1),{scale:u,zeroPoint:d,min:c,max:l}}}function Ze(o,t,e,n,s=o.length){let i=new Int8Array(o.length);if(n&&t instanceof Float32Array){let r=t.length;for(let a=0;a<r;a++){let c=t[a]??1,l=e[a]??0;for(let u=0;u<s;u++){let d=a*s+u,h=o[d]??0;i[d]=Math.max(-128,Math.min(127,Math.round(h/c+l)))}}}else{let r=t,a=e;for(let c=0;c<o.length;c++){let l=o[c]??0;i[c]=Math.max(-128,Math.min(127,Math.round(l/r+a)))}}return i}function Rn(o,t,e,n,s=o.length){let i=new Uint8Array(o.length);if(n&&t instanceof Float32Array){let r=t.length;for(let a=0;a<r;a++){let c=t[a]??1,l=e[a]??0;for(let u=0;u<s;u++){let d=a*s+u,h=o[d]??0;i[d]=Math.max(0,Math.min(255,Math.round(h/c+l)))}}}else{let r=t,a=e;for(let c=0;c<o.length;c++){let l=o[c]??0;i[c]=Math.max(0,Math.min(255,Math.round(l/r+a)))}}return i}function Ds(o,t,e){let n=Math.ceil(o.length/2),s=new Uint8Array(n);for(let i=0;i<o.length;i+=2){let r=o[i]??0,a=o[i+1]??0,c=Math.max(0,Math.min(15,Math.round(r/t+e+8))),l=Math.max(0,Math.min(15,Math.round(a/t+e+8)));s[i>>1]=c<<4|l}return s}function On(o){let t=new Uint16Array(o.length);for(let e=0;e<o.length;e++)t[e]=Ls(o[e]??0);return t}function Ls(o){let t=new Float32Array(1),e=new Int32Array(t.buffer);t[0]=o;let n=e[0],s=n>>16&32768,i=(n>>23&255)-127+15,r=n&8388607;if(i<=0){if(i<-10)return s;let a=(r|8388608)>>1-i;return s|a>>13}else if(i>=31)return s|31744;return s|i<<10|r>>13}function et(o,t,e,n=!1,s=o.length){let i=new Float32Array(o.length);if(n&&t instanceof Float32Array){let r=t.length;for(let a=0;a<r;a++){let c=t[a]??1,l=e[a]??0;for(let u=0;u<s;u++){let d=a*s+u;i[d]=((o[d]??0)-l)*c}}}else{let r=t,a=e;for(let c=0;c<o.length;c++)i[c]=((o[c]??0)-a)*r}return i}function Et(o,t,e,n=!1,s=o.length){let i=new Float32Array(o.length);if(n&&t instanceof Float32Array){let r=t.length;for(let a=0;a<r;a++){let c=t[a]??1,l=e[a]??0;for(let u=0;u<s;u++){let d=a*s+u;i[d]=((o[d]??0)-l)*c}}}else{let r=t,a=e;for(let c=0;c<o.length;c++)i[c]=((o[c]??0)-a)*r}return i}function Ft(o){let t=(o&32768)>>15,e=(o&31744)>>10,n=o&1023;return e===0?n===0?t===0?0:-0:(t===0?1:-1)*Math.pow(2,-14)*(n/1024):e===31?n===0?t===0?1/0:-1/0:NaN:(t===0?1:-1)*Math.pow(2,e-15)*(1+n/1024)}function Pt(o){let t=new Float32Array(o.length);for(let e=0;e<o.length;e++)t[e]=Ft(o[e]??0);return t}function Dt(o){let t=[],e=new Float32Array(o);return t.push({name:"model_weights",data:e,shape:[e.length],dtype:"float32"}),t}function _s(o){let t=new TextEncoder,e=20;for(let a of o.weights){let c=t.encode(a.name),l=t.encode(a.dtype),u=t.encode(a.originalDtype);e+=4+c.length,e+=4+a.shape.length*4,e+=4+l.length,e+=4+u.length,e+=1,a.scale!==void 0&&(e+=Array.isArray(a.scale)?4+a.scale.length*4:4),e+=1,a.zeroPoint!==void 0&&(e+=Array.isArray(a.zeroPoint)?4+a.zeroPoint.length*4:4),e+=8+a.data.byteLength}let n=new ArrayBuffer(e),s=new DataView(n),i=new Uint8Array(n),r=0;s.setUint32(r,o.version,!0),r+=4,s.setUint32(r,["int8","uint8","int4","float16","dynamic"].indexOf(o.quantizationType),!0),r+=4,s.setUint32(r,o.originalSize&4294967295,!0),r+=4,s.setUint32(r,o.originalSize/4294967296>>>0,!0),r+=4,s.setUint32(r,o.weights.length,!0),r+=4;for(let a of o.weights){let c=t.encode(a.name),l=t.encode(a.dtype),u=t.encode(a.originalDtype);s.setUint32(r,c.length,!0),r+=4,i.set(c,r),r+=c.length,s.setUint32(r,a.shape.length,!0),r+=4;for(let p of a.shape)s.setInt32(r,p,!0),r+=4;if(s.setUint32(r,l.length,!0),r+=4,i.set(l,r),r+=l.length,s.setUint32(r,u.length,!0),r+=4,i.set(u,r),r+=u.length,a.scale!==void 0)if(s.setUint8(r,1),r+=1,Array.isArray(a.scale)){s.setUint32(r,a.scale.length,!0),r+=4;for(let p of a.scale)s.setFloat32(r,p,!0),r+=4}else s.setUint32(r,1,!0),r+=4,s.setFloat32(r,a.scale,!0),r+=4;else s.setUint8(r,0),r+=1;if(a.zeroPoint!==void 0)if(s.setUint8(r,1),r+=1,Array.isArray(a.zeroPoint)){s.setUint32(r,a.zeroPoint.length,!0),r+=4;for(let p of a.zeroPoint)s.setInt32(r,p,!0),r+=4}else s.setUint32(r,1,!0),r+=4,s.setInt32(r,a.zeroPoint,!0),r+=4;else s.setUint8(r,0),r+=1;let d=a.data.byteLength&4294967295,h=a.data.byteLength/4294967296>>>0;s.setUint32(r,d,!0),r+=4,s.setUint32(r,h,!0),r+=4,i.set(new Uint8Array(a.data),r),r+=a.data.byteLength}return n}async function Lt(o,t){let{type:e,skipPatterns:n=[],perChannel:s=!1,symmetric:i=!0,onProgress:r,minTensorSize:a=100}=t,c=o.byteLength,l=[],u=0,d=0;r?.({stage:"analyzing",current:0,total:1,percent:0});let h=Dt(o),p=[],m=0,y=0,w=[];for(let z=0;z<h.length;z++){let A=h[z],st=(z+1)/h.length*100;if(r?.({stage:"quantizing",current:z+1,total:h.length,percent:st,layerName:A.name}),m+=A.data.length,A.data.length<a||n.some(Ee=>typeof Ee=="string"?A.name.includes(Ee):Ee.test(A.name))){d++,l.push({name:A.name,originalDtype:A.dtype,quantizedDtype:A.dtype,originalSize:A.data.byteLength,quantizedSize:A.data.byteLength,scale:1,zeroPoint:0,minValue:Math.min(...A.data),maxValue:Math.max(...A.data),skipped:!0,skipReason:A.data.length<a?"Tensor too small":"Matched skip pattern"}),p.push({name:A.name,data:A.data.buffer.slice(0),shape:A.shape,dtype:A.dtype,originalDtype:A.dtype});continue}let es=e==="int4"?4:8,D=Nn(A.data,es,i,s,0,A.shape),Z,ee;switch(e){case"int8":Z=Ze(A.data,D.scale,D.zeroPoint,s,s?A.data.length/(A.shape[0]??1):A.data.length).buffer.slice(0),ee="int8";break;case"uint8":Z=Rn(A.data,D.scale,D.zeroPoint,s,s?A.data.length/(A.shape[0]??1):A.data.length).buffer.slice(0),ee="uint8";break;case"int4":Z=Ds(A.data,D.scale,D.zeroPoint).buffer.slice(0),ee="int4";break;case"float16":Z=On(A.data).buffer.slice(0),ee="float16";break;case"dynamic":default:Z=Ze(A.data,D.scale,D.zeroPoint,s,s?A.data.length/(A.shape[0]??1):A.data.length).buffer.slice(0),ee="int8";break}u++,y+=A.data.length;let de=D.scale instanceof Float32Array?Array.from(D.scale):D.scale,Bt=D.zeroPoint instanceof Int32Array?Array.from(D.zeroPoint):D.zeroPoint;typeof de=="number"?w.push(de):w.push(...de),l.push({name:A.name,originalDtype:A.dtype,quantizedDtype:ee,originalSize:A.data.byteLength,quantizedSize:Z.byteLength,scale:de,zeroPoint:Bt,minValue:D.min,maxValue:D.max,skipped:!1}),p.push({name:A.name,data:Z,shape:A.shape,dtype:ee,originalDtype:A.dtype,scale:de,zeroPoint:Bt})}r?.({stage:"packing",current:0,total:1,percent:0});let T=_s({version:1,quantizationType:e,originalSize:c,weights:p});r?.({stage:"complete",current:1,total:1,percent:100});let b=w.length>0?w.reduce((z,A)=>z+A,0)/w.length:1,I=w.length>0?Math.min(...w):1,S=w.length>0?Math.max(...w):1,E=b/(e==="int4"?8:e==="float16"?2:4);return{data:T,originalSize:c,quantizedSize:T.byteLength,compressionRatio:c/T.byteLength,tensorsQuantized:u,tensorsSkipped:d,layerStats:l,stats:{totalParameters:m,quantizedParameters:y,averageScale:b,minScale:I,maxScale:S,errorEstimate:E}}}function $n(o,t,e={}){let{symmetric:n=!0,perChannel:s=!1}=e,i=o.toFloat32Array(),r=o.shape,c=Nn(i,t==="int4"?4:8,n,s,0,r),l,u;switch(t){case"int8":l=Ze(i,c.scale,c.zeroPoint,s),u="int32";break;case"uint8":l=Rn(i,c.scale,c.zeroPoint,s),u="int32";break;case"float16":l=On(i),u="float32";break;default:l=Ze(i,c.scale,c.zeroPoint,s),u="int32"}let d=c.scale instanceof Float32Array?Array.from(c.scale):c.scale,h=c.zeroPoint instanceof Int32Array?Array.from(c.zeroPoint):c.zeroPoint;return{tensor:new g(Array.from(l),r,u),scale:d,zeroPoint:h}}function Bn(o,t,e,n){let s=o.toArray(),i=o.shape,r,a=Array.isArray(t)?new Float32Array(t):t,c=Array.isArray(e)?new Int32Array(e):e,l=Array.isArray(t);switch(n){case"int8":r=et(new Int8Array(s.map(Number)),a,c,l);break;case"uint8":r=Et(new Uint8Array(s.map(Number)),a,c,l);break;case"float16":r=Pt(new Uint16Array(s.map(Number)));break;default:r=et(new Int8Array(s.map(Number)),a,c,l)}return new g(Array.from(r),i,"float32")}function _t(o,t={}){let{ratio:e=.5,method:n="magnitude",threshold:s}=t,i=o.toFloat32Array(),r=o.shape,a=new Float32Array(i.length),c=new Float32Array(i.length),l=0;if(n==="magnitude"){let u=Array.from(i).map(Math.abs).sort((p,m)=>p-m),d=Math.floor(u.length*e),h=s??u[d]??0;for(let p=0;p<i.length;p++)Math.abs(i[p]??0)>h?(a[p]=1,c[p]=i[p]??0):(a[p]=0,c[p]=0,l++)}else if(n==="random")for(let u=0;u<i.length;u++)Math.random()>e?(a[u]=1,c[u]=i[u]??0):(a[u]=0,c[u]=0,l++);return{tensor:new g(Array.from(c),r,"float32"),mask:new g(Array.from(a),r,"float32"),sparsity:l/i.length}}async function Un(o,t={}){let{onProgress:e}=t;e?.({current:0,total:1,percent:0});let n=Dt(o),s=0,i=0;for(let r of n){s+=r.data.length;let a=new g(Array.from(r.data),r.shape,"float32"),{sparsity:c}=_t(a,t);i+=Math.floor(r.data.length*c)}return e?.({current:1,total:1,percent:100}),{data:o,originalSize:o.byteLength,prunedSize:o.byteLength,sparsity:i/s,parametersPruned:i,totalParameters:s}}async function qn(o){let t=Dt(o),e=o.byteLength,n={},s=0,i=[];for(let l of t){s+=l.data.length;let u=l.dtype==="float32"?4:l.dtype==="float16"?2:l.dtype==="int8"?1:4,d=l.data.length*u;n[l.dtype]||(n[l.dtype]={count:0,size:0}),n[l.dtype].count++,n[l.dtype].size+=d,i.push({name:l.name,size:d,shape:l.shape})}i.sort((l,u)=>u.size-l.size);let r=i.slice(0,10),a={int8:Math.ceil(e/4),uint8:Math.ceil(e/4),int4:Math.ceil(e/8),float16:Math.ceil(e/2),dynamic:Math.ceil(e/4)},c="dynamic";return e>500*1024*1024?c="int4":e>100*1024*1024?c="int8":e>50*1024*1024&&(c="float16"),{totalSize:e,tensorCount:t.length,totalParameters:s,dtypeBreakdown:n,largestTensors:r,estimatedMemory:s*4,recommendedQuantization:c,estimatedQuantizedSizes:a}}async function jn(o,t){let{format:e,quantize:n}=t,s=o;switch(n&&(s=(await Lt(o,{type:n})).data),e){case"edgeflow":return s;case"onnx":return s;case"tflite":return s;default:return s}}function Cs(o){let t=o instanceof Float32Array?o:new Float32Array(o),e=1/0,n=-1/0,s=0,i=0,r=0,a=0;for(let h=0;h<t.length;h++){let p=t[h]??0;if(isNaN(p)){r++;continue}if(!isFinite(p)){a++;continue}e=Math.min(e,p),n=Math.max(n,p),s+=p,p===0&&i++}let c=t.length-r-a,l=c>0?s/c:0,u=0;for(let h=0;h<t.length;h++){let p=t[h]??0;!isNaN(p)&&isFinite(p)&&(u+=Math.pow(p-l,2))}let d=c>0?Math.sqrt(u/c):0;return{min:e===1/0?0:e,max:n===-1/0?0:n,mean:l,std:d,zeros:i,nans:r,infinities:a,sparsity:i/t.length}}function Ns(o,t=50){let e=o instanceof Float32Array?o:new Float32Array(o),n=1/0,s=-1/0;for(let c=0;c<e.length;c++){let l=e[c]??0;!isNaN(l)&&isFinite(l)&&(n=Math.min(n,l),s=Math.max(s,l))}if(n===1/0||s===-1/0||n===s)return{bins:[n||0],counts:[e.length],binEdges:[n||0,s||0]};let i=(s-n)/t,r=new Array(t).fill(0),a=new Array(t+1);for(let c=0;c<=t;c++)a[c]=n+c*i;for(let c=0;c<e.length;c++){let l=e[c]??0;if(!isNaN(l)&&isFinite(l)){let u=Math.min(Math.floor((l-n)/i),t-1);r[u]++}}return{bins:a.slice(0,-1).map((c,l)=>(c+a[l+1])/2),counts:r,binEdges:a}}function Se(o,t="tensor",e={}){let{histogram:n=!0,maxSample:s=10}=e,i=o.toFloat32Array(),r=o.shape,a=o.size,c=[],l=Math.max(1,Math.floor(a/s));for(let p=0;p<a&&c.length<s;p+=l)c.push(p);let u=c.map(p=>i[p]??0),d=o.dtype==="float32"||o.dtype==="int32"?4:o.dtype==="int64"?8:4,h=a*d;return{name:t,shape:r,dtype:o.dtype,size:a,memoryBytes:h,stats:Cs(i),sample:u,histogram:n?Ns(i):void 0}}function Wn(o){let{name:t,shape:e,dtype:n,size:s,memoryBytes:i,stats:r,sample:a}=o,c=[`\u250C\u2500 Tensor: ${t} \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500`,`\u2502 Shape: [${e.join(", ")}]`,`\u2502 Dtype: ${n}`,`\u2502 Size: ${s.toLocaleString()} elements`,`\u2502 Memory: ${Ct(i)}`,"\u251C\u2500 Statistics \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500",`\u2502 Min: ${r.min.toFixed(6)}`,`\u2502 Max: ${r.max.toFixed(6)}`,`\u2502 Mean: ${r.mean.toFixed(6)}`,`\u2502 Std: ${r.std.toFixed(6)}`,`\u2502 Sparsity: ${(r.sparsity*100).toFixed(2)}%`];return r.nans>0&&c.push(`\u2502 \u26A0\uFE0F NaN values: ${r.nans}`),r.infinities>0&&c.push(`\u2502 \u26A0\uFE0F Infinity values: ${r.infinities}`),c.push("\u251C\u2500 Sample Values \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500"),c.push(`\u2502 [${a.map(l=>l.toFixed(4)).join(", ")}]`),c.push("\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500"),c.join(`
`)}function Ct(o){return o<1024?`${o} B`:o<1024*1024?`${(o/1024).toFixed(2)} KB`:o<1024*1024*1024?`${(o/(1024*1024)).toFixed(2)} MB`:`${(o/(1024*1024*1024)).toFixed(2)} GB`}var ze=class{constructor(t={}){f(this,"config");f(this,"events",[]);f(this,"traces",[]);f(this,"performanceMetrics");f(this,"listeners",new Map);f(this,"isEnabled",!0);this.config={logging:t.logging??!0,logLevel:t.logLevel??"info",inspectTensors:t.inspectTensors??!0,maxDisplayValues:t.maxDisplayValues??10,trackPerformance:t.trackPerformance??!0,logger:t.logger??this.defaultLogger.bind(this)},this.performanceMetrics={inferenceCount:0,totalInferenceTime:0,averageInferenceTime:0,minInferenceTime:1/0,maxInferenceTime:0,peakMemoryUsage:0,currentMemoryUsage:0,tensorAllocations:0,tensorDeallocations:0}}defaultLogger(t,e,n){let i=`[edgeFlow.js ${new Date().toISOString()}] [${t.toUpperCase()}]`;switch(t){case"debug":console.debug(i,e,n??"");break;case"info":console.info(i,e,n??"");break;case"warn":console.warn(i,e,n??"");break;case"error":console.error(i,e,n??"");break;default:console.log(i,e,n??"")}}log(t,e,n){if(!this.isEnabled||!this.config.logging)return;let s=["debug","info","warn","error"],i=s.indexOf(this.config.logLevel);s.indexOf(t)>=i&&this.config.logger(t,e,n)}addEvent(t){this.events.push(t);let e=this.listeners.get(t.type)??[];for(let n of e)n(t);this.events.length>1e3&&(this.events=this.events.slice(-1e3))}enable(){this.isEnabled=!0,this.log("info","Debugger enabled")}disable(){this.isEnabled=!1}on(t,e){let n=this.listeners.get(t)??[];return n.push(e),this.listeners.set(t,n),()=>{let s=n.indexOf(e);s!==-1&&n.splice(s,1)}}inspectTensor(t,e="tensor"){let n=Se(t,e,{histogram:!0,maxSample:this.config.maxDisplayValues});return this.config.inspectTensors&&(this.log("debug",`Tensor: ${e}`,n),this.addEvent({type:"tensor",timestamp:Date.now(),message:`Inspected tensor: ${e}`,data:n}),n.stats.nans>0&&this.log("warn",`Tensor "${e}" contains ${n.stats.nans} NaN values`),n.stats.infinities>0&&this.log("warn",`Tensor "${e}" contains ${n.stats.infinities} Infinity values`)),n}startTrace(t){let e=`trace_${Date.now()}_${Math.random().toString(36).slice(2,8)}`,n={id:e,modelId:t,timestamp:Date.now(),inputs:[],outputs:[],duration:0,memoryUsed:0,operations:[]};return this.traces.push(n),this.log("debug",`Started trace: ${e} for model: ${t}`),e}traceInput(t,e,n){let s=this.traces.find(i=>i.id===t);s&&s.inputs.push(Se(e,n))}traceOutput(t,e,n){let s=this.traces.find(i=>i.id===t);s&&s.outputs.push(Se(e,n))}traceOperation(t,e){let n=this.traces.find(s=>s.id===t);n&&n.operations.push(e)}endTrace(t){let e=this.traces.find(n=>n.id===t);if(e)return e.duration=Date.now()-e.timestamp,this.performanceMetrics.inferenceCount++,this.performanceMetrics.totalInferenceTime+=e.duration,this.performanceMetrics.averageInferenceTime=this.performanceMetrics.totalInferenceTime/this.performanceMetrics.inferenceCount,this.performanceMetrics.minInferenceTime=Math.min(this.performanceMetrics.minInferenceTime,e.duration),this.performanceMetrics.maxInferenceTime=Math.max(this.performanceMetrics.maxInferenceTime,e.duration),this.log("info",`Trace completed: ${t}`,{duration:`${e.duration}ms`,inputs:e.inputs.length,outputs:e.outputs.length,operations:e.operations.length}),this.addEvent({type:"inference",timestamp:Date.now(),message:`Inference completed in ${e.duration}ms`,data:e}),e}recordAllocation(t){if(!this.config.trackPerformance)return;this.performanceMetrics.tensorAllocations++;let e=t.size*4;this.performanceMetrics.currentMemoryUsage+=e,this.performanceMetrics.peakMemoryUsage=Math.max(this.performanceMetrics.peakMemoryUsage,this.performanceMetrics.currentMemoryUsage)}recordDeallocation(t){if(!this.config.trackPerformance)return;this.performanceMetrics.tensorDeallocations++;let e=t.size*4;this.performanceMetrics.currentMemoryUsage-=e}getPerformanceMetrics(){return{...this.performanceMetrics}}getEvents(){return[...this.events]}getTraces(){return[...this.traces]}getTrace(t){return this.traces.find(e=>e.id===t)}clear(){this.events=[],this.traces=[],this.performanceMetrics={inferenceCount:0,totalInferenceTime:0,averageInferenceTime:0,minInferenceTime:1/0,maxInferenceTime:0,peakMemoryUsage:0,currentMemoryUsage:0,tensorAllocations:0,tensorDeallocations:0}}export(){return{events:this.getEvents(),traces:this.getTraces(),metrics:this.getPerformanceMetrics(),timestamp:Date.now()}}generateReport(){let t=this.getPerformanceMetrics(),e=this.getTraces(),n=["\u2554\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2557","\u2551               edgeFlow.js Debug Report                          \u2551","\u2560\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2563","\u2551 Performance Metrics                                             \u2551","\u255F\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2562",`\u2551 Total Inferences:     ${t.inferenceCount.toString().padStart(10)}                          \u2551`,`\u2551 Average Time:         ${t.averageInferenceTime.toFixed(2).padStart(10)}ms                       \u2551`,`\u2551 Min Time:             ${(t.minInferenceTime===1/0?0:t.minInferenceTime).toFixed(2).padStart(10)}ms                       \u2551`,`\u2551 Max Time:             ${t.maxInferenceTime.toFixed(2).padStart(10)}ms                       \u2551`,`\u2551 Peak Memory:          ${Ct(t.peakMemoryUsage).padStart(10)}                          \u2551`,`\u2551 Current Memory:       ${Ct(t.currentMemoryUsage).padStart(10)}                          \u2551`,`\u2551 Tensor Allocations:   ${t.tensorAllocations.toString().padStart(10)}                          \u2551`,`\u2551 Tensor Deallocations: ${t.tensorDeallocations.toString().padStart(10)}                          \u2551`,"\u255F\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2562","\u2551 Recent Traces                                                   \u2551","\u255F\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2562"],s=e.slice(-5);for(let i of s)n.push(`\u2551 ${i.id.slice(0,20).padEnd(20)} | ${i.duration.toFixed(2).padStart(8)}ms | ${i.modelId.slice(0,20).padEnd(20)} \u2551`);return s.length===0&&n.push("\u2551 No traces recorded                                              \u2551"),n.push("\u255A\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u255D"),n.join(`
`)}},tt=null;function Nt(o){return(!tt||o)&&(tt=new ze(o)),tt}function Hn(o){let t=Nt(o);return t.enable(),t}function Vn(){tt?.disable()}function Gn(o,t=50,e=10){let{counts:n,binEdges:s}=o,i=Math.max(...n);if(i===0)return"No data to display";let r=[],a=n.map(u=>Math.round(u/i*e));for(let u=e;u>0;u--){let d=u===e?`${i.toString().padStart(6)} \u2502`:"       \u2502";for(let h=0;h<t&&h<a.length;h++)d+=(a[h]??0)>=u?"\u2588":" ";r.push(d)}r.push("       \u2514"+"\u2500".repeat(Math.min(t,a.length)));let c=(s[0]??0).toFixed(2),l=(s[s.length-1]??0).toFixed(2);return r.push(`        ${c}${" ".repeat(Math.max(0,Math.min(t,a.length)-c.length-l.length))}${l}`),r.join(`
`)}function Xn(o,t=40){let e=o.shape;if(e.length!==2)return"Heatmap only supports 2D tensors";let[n,s]=e;if(n===void 0||s===void 0)return"Invalid tensor shape";let i=o.toFloat32Array(),r=1/0,a=-1/0;for(let p=0;p<i.length;p++){let m=i[p]??0;!isNaN(m)&&isFinite(m)&&(r=Math.min(r,m),a=Math.max(a,m))}let c=a-r,l=[" ","\u2591","\u2592","\u2593","\u2588"],u=[],d=Math.max(1,Math.ceil(s/t)),h=Math.min(s,t);for(let p=0;p<n;p++){let m="";for(let y=0;y<h;y++){let w=p*s+y*d,k=i[w]??0,T=c>0?(k-r)/c:0,b=Math.floor(T*(l.length-1));m+=l[b]}u.push(m)}return u.join(`
`)}function Qn(o){let t=[];t.push("\u250C\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510"),t.push("\u2502                        Model Architecture                          \u2502"),t.push("\u251C\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524");for(let e=0;e<o.length;e++){let n=o[e],s=`[${n.inputShape.join("\xD7")}]`,i=`[${n.outputShape.join("\xD7")}]`;t.push(`\u2502 ${(e+1).toString().padStart(2)}. ${n.name.padEnd(20)} \u2502 ${n.type.padEnd(15)} \u2502`),t.push(`\u2502     ${s.padEnd(15)} \u2192 ${i.padEnd(15)}                   \u2502`),e<o.length-1&&t.push("\u2502                           \u2193                                        \u2502")}return t.push("\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518"),t.join(`
`)}var ve=class{constructor(t={}){f(this,"config");f(this,"samples",[]);f(this,"isRunning",!1);f(this,"intervalId",null);f(this,"alerts",[]);f(this,"alertListeners",[]);f(this,"sampleListeners",[]);f(this,"inferenceCount",0);f(this,"inferenceTimes",[]);f(this,"queueLength",0);f(this,"activeCount",0);f(this,"frameCount",0);f(this,"lastFrameTime",0);f(this,"fps",0);f(this,"rafId",null);f(this,"tensorMemory",0);f(this,"cacheMemory",0);this.config={enabled:t.enabled??!0,sampleInterval:t.sampleInterval??1e3,historySize:t.historySize??60,monitorMemory:t.monitorMemory??!0,monitorFPS:t.monitorFPS??!0,collectors:t.collectors??[]}}start(){this.isRunning||(this.isRunning=!0,this.intervalId=setInterval(()=>{this.collectSample()},this.config.sampleInterval),this.config.monitorFPS&&typeof requestAnimationFrame<"u"&&(this.lastFrameTime=performance.now(),this.frameCount=0,this.monitorFPS()))}stop(){this.isRunning=!1,this.intervalId&&(clearInterval(this.intervalId),this.intervalId=null),this.rafId&&(cancelAnimationFrame(this.rafId),this.rafId=null)}monitorFPS(){if(!this.isRunning)return;this.frameCount++;let t=performance.now(),e=t-this.lastFrameTime;e>=1e3&&(this.fps=Math.round(this.frameCount*1e3/e),this.frameCount=0,this.lastFrameTime=t),this.rafId=requestAnimationFrame(()=>this.monitorFPS())}collectSample(){let t=Date.now(),e=this.inferenceTimes.length>0?this.inferenceTimes.reduce((d,h)=>d+h,0)/this.inferenceTimes.length:0,n=this.inferenceTimes.length>0?Math.min(...this.inferenceTimes):0,s=this.inferenceTimes.length>0?Math.max(...this.inferenceTimes):0,i=this.inferenceCount/(this.config.sampleInterval/1e3),r={count:this.inferenceCount,avgTime:e,minTime:n,maxTime:s,throughput:i,queueLength:this.queueLength,activeCount:this.activeCount},a=this.collectMemoryMetrics(),c=this.collectSystemMetrics(),l={};for(let d of this.config.collectors)try{Object.assign(l,d())}catch{}let u={timestamp:t,inference:r,memory:a,system:c,custom:l};this.samples.push(u),this.samples.length>this.config.historySize&&this.samples.shift(),this.checkAlerts(u);for(let d of this.sampleListeners)d(u);this.inferenceCount=0,this.inferenceTimes=[]}collectMemoryMetrics(){let t=0,e=0,n=0;if(typeof performance<"u"&&"memory"in performance){let s=performance.memory;t=s.usedJSHeapSize,e=s.totalJSHeapSize,n=s.jsHeapSizeLimit}return{usedHeap:t,totalHeap:e,heapLimit:n,heapUsage:n>0?t/n:0,tensorMemory:this.tensorMemory,cacheMemory:this.cacheMemory}}collectSystemMetrics(){let t=this.samples[this.samples.length-1],e=t?Date.now()-t.timestamp:this.config.sampleInterval,n=!1;typeof navigator<"u"&&"gpu"in navigator&&(n=!0);let s=!1;return typeof navigator<"u"&&"ml"in navigator&&(s=!0),{fps:this.fps,cpuUsage:this.estimateCPUUsage(),deltaTime:e,userAgent:typeof navigator<"u"?navigator.userAgent:"unknown",webgpuAvailable:n,webnnAvailable:s}}estimateCPUUsage(){if(this.inferenceTimes.length===0)return 0;let t=this.inferenceTimes.reduce((e,n)=>e+n,0);return Math.min(1,t/this.config.sampleInterval)}checkAlerts(t){for(let e of this.alerts){let n=this.getMetricValue(t,e.metric);if(n===void 0)continue;let s=!1;switch(e.operator){case">":s=n>e.threshold;break;case"<":s=n<e.threshold;break;case">=":s=n>=e.threshold;break;case"<=":s=n<=e.threshold;break;case"==":s=n===e.threshold;break;case"!=":s=n!==e.threshold;break}if(s){let i={config:e,value:n,timestamp:t.timestamp};for(let r of this.alertListeners)r(i)}}}getMetricValue(t,e){let n=e.split("."),s=t;for(let i of n)if(s&&typeof s=="object"&&i in s)s=s[i];else return;return typeof s=="number"?s:void 0}recordInference(t){this.inferenceCount++,this.inferenceTimes.push(t)}updateQueueLength(t){this.queueLength=t}updateActiveCount(t){this.activeCount=t}updateTensorMemory(t){this.tensorMemory=t}updateCacheMemory(t){this.cacheMemory=t}addAlert(t){this.alerts.push(t)}removeAlert(t){this.alerts=this.alerts.filter(e=>e.metric!==t)}onAlert(t){return this.alertListeners.push(t),()=>{let e=this.alertListeners.indexOf(t);e!==-1&&this.alertListeners.splice(e,1)}}onSample(t){return this.sampleListeners.push(t),()=>{let e=this.sampleListeners.indexOf(t);e!==-1&&this.sampleListeners.splice(e,1)}}getCurrentSample(){return this.samples[this.samples.length-1]}getSamples(){return[...this.samples]}getSamplesInRange(t,e){return this.samples.filter(n=>n.timestamp>=t&&n.timestamp<=e)}getSummary(){if(this.samples.length===0)return{avgInferenceTime:0,avgThroughput:0,avgMemoryUsage:0,avgFPS:0,totalInferences:0,uptime:0};let t=this.samples.reduce((l,u)=>l+u.inference.avgTime,0)/this.samples.length,e=this.samples.reduce((l,u)=>l+u.inference.throughput,0)/this.samples.length,n=this.samples.reduce((l,u)=>l+u.memory.heapUsage,0)/this.samples.length,s=this.samples.reduce((l,u)=>l+u.system.fps,0)/this.samples.length,i=this.samples.reduce((l,u)=>l+u.inference.count,0),r=this.samples[0],c=this.samples[this.samples.length-1].timestamp-r.timestamp;return{avgInferenceTime:t,avgThroughput:e,avgMemoryUsage:n,avgFPS:s,totalInferences:i,uptime:c}}clear(){this.samples=[],this.inferenceCount=0,this.inferenceTimes=[],this.queueLength=0,this.activeCount=0,this.tensorMemory=0,this.cacheMemory=0}export(){return{samples:this.getSamples(),summary:this.getSummary(),config:this.config,timestamp:Date.now()}}};function Kn(o){let t=o.getSummary(),e=o.getSamples(),n=e[e.length-1],s=r=>r<1024?`${r} B`:r<1024*1024?`${(r/1024).toFixed(1)} KB`:r<1024*1024*1024?`${(r/(1024*1024)).toFixed(1)} MB`:`${(r/(1024*1024*1024)).toFixed(1)} GB`;return`
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>edgeFlow.js Performance Dashboard</title>
  <style>
    :root {
      --bg-primary: #0d1117;
      --bg-secondary: #161b22;
      --bg-tertiary: #21262d;
      --text-primary: #f0f6fc;
      --text-secondary: #8b949e;
      --accent: #58a6ff;
      --success: #3fb950;
      --warning: #d29922;
      --error: #f85149;
    }
    
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
      background: var(--bg-primary);
      color: var(--text-primary);
      line-height: 1.6;
    }
    
    .dashboard {
      max-width: 1400px;
      margin: 0 auto;
      padding: 24px;
    }
    
    header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 32px;
      padding-bottom: 16px;
      border-bottom: 1px solid var(--bg-tertiary);
    }
    
    h1 {
      font-size: 24px;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 12px;
    }
    
    .status {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 14px;
      color: var(--text-secondary);
    }
    
    .status-dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: var(--success);
    }
    
    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 20px;
      margin-bottom: 32px;
    }
    
    .card {
      background: var(--bg-secondary);
      border: 1px solid var(--bg-tertiary);
      border-radius: 12px;
      padding: 20px;
    }
    
    .card-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 16px;
    }
    
    .card-title {
      font-size: 14px;
      font-weight: 500;
      color: var(--text-secondary);
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    
    .card-value {
      font-size: 36px;
      font-weight: 700;
      font-variant-numeric: tabular-nums;
    }
    
    .card-value.small {
      font-size: 24px;
    }
    
    .card-unit {
      font-size: 14px;
      color: var(--text-secondary);
      margin-left: 4px;
    }
    
    .card-change {
      font-size: 12px;
      padding: 4px 8px;
      border-radius: 4px;
    }
    
    .card-change.up {
      background: rgba(63, 185, 80, 0.2);
      color: var(--success);
    }
    
    .card-change.down {
      background: rgba(248, 81, 73, 0.2);
      color: var(--error);
    }
    
    .progress-bar {
      height: 8px;
      background: var(--bg-tertiary);
      border-radius: 4px;
      overflow: hidden;
      margin-top: 12px;
    }
    
    .progress-fill {
      height: 100%;
      border-radius: 4px;
      transition: width 0.3s ease;
    }
    
    .progress-fill.blue { background: var(--accent); }
    .progress-fill.green { background: var(--success); }
    .progress-fill.yellow { background: var(--warning); }
    .progress-fill.red { background: var(--error); }
    
    .chart-container {
      background: var(--bg-secondary);
      border: 1px solid var(--bg-tertiary);
      border-radius: 12px;
      padding: 20px;
      margin-bottom: 20px;
    }
    
    .chart-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 16px;
    }
    
    .chart-title {
      font-size: 16px;
      font-weight: 600;
    }
    
    .chart {
      height: 200px;
      position: relative;
    }
    
    .chart-line {
      stroke: var(--accent);
      stroke-width: 2;
      fill: none;
    }
    
    .chart-area {
      fill: url(#chartGradient);
      opacity: 0.3;
    }
    
    .chart-grid {
      stroke: var(--bg-tertiary);
      stroke-width: 1;
    }
    
    .table {
      width: 100%;
      border-collapse: collapse;
    }
    
    .table th,
    .table td {
      padding: 12px 16px;
      text-align: left;
      border-bottom: 1px solid var(--bg-tertiary);
    }
    
    .table th {
      font-size: 12px;
      font-weight: 500;
      color: var(--text-secondary);
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    
    .table td {
      font-variant-numeric: tabular-nums;
    }
    
    footer {
      text-align: center;
      padding: 24px;
      color: var(--text-secondary);
      font-size: 14px;
    }
  </style>
</head>
<body>
  <div class="dashboard">
    <header>
      <h1>
        <svg width="32" height="32" viewBox="0 0 32 32" fill="none">
          <rect width="32" height="32" rx="8" fill="var(--accent)"/>
          <path d="M8 16L14 10L20 16L26 10" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          <path d="M8 22L14 16L20 22L26 16" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" opacity="0.5"/>
        </svg>
        edgeFlow.js Performance Dashboard
      </h1>
      <div class="status">
        <div class="status-dot"></div>
        Running for ${(r=>r<1e3?`${r.toFixed(0)}ms`:r<6e4?`${(r/1e3).toFixed(1)}s`:`${(r/6e4).toFixed(1)}m`)(t.uptime)}
      </div>
    </header>
    
    <div class="grid">
      <div class="card">
        <div class="card-header">
          <span class="card-title">Total Inferences</span>
        </div>
        <div class="card-value">${t.totalInferences.toLocaleString()}</div>
      </div>
      
      <div class="card">
        <div class="card-header">
          <span class="card-title">Avg Inference Time</span>
        </div>
        <div class="card-value">${t.avgInferenceTime.toFixed(1)}<span class="card-unit">ms</span></div>
      </div>
      
      <div class="card">
        <div class="card-header">
          <span class="card-title">Throughput</span>
        </div>
        <div class="card-value">${t.avgThroughput.toFixed(1)}<span class="card-unit">ops/s</span></div>
      </div>
      
      <div class="card">
        <div class="card-header">
          <span class="card-title">Avg FPS</span>
        </div>
        <div class="card-value">${Math.round(t.avgFPS)}</div>
      </div>
    </div>
    
    <div class="grid">
      <div class="card">
        <div class="card-header">
          <span class="card-title">Memory Usage</span>
        </div>
        <div class="card-value small">${s(n?.memory.usedHeap??0)}</div>
        <div class="progress-bar">
          <div class="progress-fill ${t.avgMemoryUsage>.8?"red":t.avgMemoryUsage>.6?"yellow":"green"}" 
               style="width: ${(t.avgMemoryUsage*100).toFixed(0)}%"></div>
        </div>
      </div>
      
      <div class="card">
        <div class="card-header">
          <span class="card-title">Tensor Memory</span>
        </div>
        <div class="card-value small">${s(n?.memory.tensorMemory??0)}</div>
      </div>
      
      <div class="card">
        <div class="card-header">
          <span class="card-title">Cache Memory</span>
        </div>
        <div class="card-value small">${s(n?.memory.cacheMemory??0)}</div>
      </div>
      
      <div class="card">
        <div class="card-header">
          <span class="card-title">Queue Length</span>
        </div>
        <div class="card-value small">${n?.inference.queueLength??0}</div>
      </div>
    </div>
    
    <div class="chart-container">
      <div class="chart-header">
        <span class="chart-title">Inference Time History</span>
      </div>
      <div class="chart">
        <svg width="100%" height="100%" viewBox="0 0 600 200" preserveAspectRatio="none">
          <defs>
            <linearGradient id="chartGradient" x1="0" y1="0" x2="0" y2="1">
              <stop offset="0%" stop-color="var(--accent)" stop-opacity="0.5"/>
              <stop offset="100%" stop-color="var(--accent)" stop-opacity="0"/>
            </linearGradient>
          </defs>
          ${Rs(e)}
        </svg>
      </div>
    </div>
    
    <div class="chart-container">
      <div class="chart-header">
        <span class="chart-title">Recent Samples</span>
      </div>
      <table class="table">
        <thead>
          <tr>
            <th>Time</th>
            <th>Inferences</th>
            <th>Avg Time</th>
            <th>Throughput</th>
            <th>Memory</th>
            <th>FPS</th>
          </tr>
        </thead>
        <tbody>
          ${e.slice(-10).reverse().map(r=>`
            <tr>
              <td>${new Date(r.timestamp).toLocaleTimeString()}</td>
              <td>${r.inference.count}</td>
              <td>${r.inference.avgTime.toFixed(2)}ms</td>
              <td>${r.inference.throughput.toFixed(1)}/s</td>
              <td>${s(r.memory.usedHeap)}</td>
              <td>${r.system.fps}</td>
            </tr>
          `).join("")}
        </tbody>
      </table>
    </div>
    
    <footer>
      Generated at ${new Date().toLocaleString()} | edgeFlow.js Performance Monitor
    </footer>
  </div>
</body>
</html>
  `.trim()}function Rs(o){if(o.length<2)return"";let t=600,e=180,n=10,s=o.map(u=>u.inference.avgTime),i=Math.max(...s,1),r=o.map((u,d)=>{let h=n+d/(o.length-1)*(t-2*n),p=e-n-u.inference.avgTime/i*(e-2*n);return`${h},${p}`}),a=`M ${r.join(" L ")}`,c=`M ${n},${e-n} L ${r.join(" L ")} L ${t-n},${e-n} Z`,l=[];for(let u=0;u<=4;u++){let d=n+u/4*(e-2*n);l.push(`<line class="chart-grid" x1="${n}" y1="${d}" x2="${t-n}" y2="${d}"/>`)}return`
    ${l.join(`
`)}
    <path class="chart-area" d="${c}"/>
    <path class="chart-line" d="${a}"/>
  `}function Jn(o){let t=o.getSummary(),e=o.getSamples(),n=e[e.length-1],s=c=>c<1024?`${c} B`:c<1024*1024?`${(c/1024).toFixed(1)} KB`:c<1024*1024*1024?`${(c/(1024*1024)).toFixed(1)} MB`:`${(c/(1024*1024*1024)).toFixed(1)} GB`,i=(c,l,u=20)=>{let d=Math.round(c/l*u);return"\u2588".repeat(d)+"\u2591".repeat(u-d)},r=["\u2554\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2557","\u2551             edgeFlow.js Performance Monitor Dashboard                   \u2551","\u2560\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2563","\u2551                                                                          \u2551",`\u2551  Total Inferences:  ${t.totalInferences.toString().padStart(10)}                                      \u2551`,`\u2551  Avg Inference:     ${t.avgInferenceTime.toFixed(2).padStart(10)}ms                                     \u2551`,`\u2551  Throughput:        ${t.avgThroughput.toFixed(2).padStart(10)} ops/s                                 \u2551`,`\u2551  Avg FPS:           ${Math.round(t.avgFPS).toString().padStart(10)}                                      \u2551`,"\u2551                                                                          \u2551","\u255F\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2562","\u2551 Memory Usage                                                             \u2551",`\u2551  Heap:    ${i(t.avgMemoryUsage,1)} ${(t.avgMemoryUsage*100).toFixed(0).padStart(3)}%            \u2551`,`\u2551  Used:    ${s(n?.memory.usedHeap??0).padStart(10)}                                          \u2551`,`\u2551  Tensor:  ${s(n?.memory.tensorMemory??0).padStart(10)}                                          \u2551`,`\u2551  Cache:   ${s(n?.memory.cacheMemory??0).padStart(10)}                                          \u2551`,"\u2551                                                                          \u2551","\u255F\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2562","\u2551 Inference Time History (last 30 samples)                                 \u2551","\u2551                                                                          \u2551"],a=e.slice(-30);if(a.length>0){let c=a.map(d=>d.inference.avgTime),l=Math.max(...c,1),u=5;for(let d=u;d>0;d--){let h="\u2551  ";for(let p of c){let m=Math.ceil(p/l*u);h+=m>=d?"\u2593":" "}r.push(h.padEnd(76)+"\u2551")}r.push("\u2551  "+"\u2500".repeat(30)+"                                            \u2551")}return r.push("\u2551                                                                          \u2551"),r.push(`\u2551  Last updated: ${new Date().toLocaleString().padEnd(40)}             \u2551`),r.push("\u255A\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u255D"),r.join(`
`)}var nt=null;function Rt(o){return(!nt||o)&&(nt=new ve(o)),nt}function Yn(o){let t=Rt(o);return t.start(),t}function Zn(){nt?.stop()}async function Os(o,t){let e=o instanceof ArrayBuffer?o:await Ot(o),n=e.byteLength,s,i=0,r=0;switch(t.method){case"int8":({data:s,layersQuantized:i,layersSkipped:r}=$s(e,t));break;case"uint8":({data:s,layersQuantized:i,layersSkipped:r}=Bs(e,t));break;case"float16":({data:s,layersQuantized:i,layersSkipped:r}=Us(e,t));break;case"int4":({data:s,layersQuantized:i,layersSkipped:r}=qs(e,t));break;default:s=e}return{modelData:s,originalSize:n,quantizedSize:s.byteLength,compressionRatio:n/s.byteLength,stats:{layersQuantized:i,layersSkipped:r}}}async function Ot(o){return new ArrayBuffer(0)}function $s(o,t){let e=new Float32Array(o),n=new Int8Array(e.length),s=0;for(let r=0;r<e.length;r++){let a=Math.abs(e[r]??0);a>s&&(s=a)}let i=s/127;for(let r=0;r<e.length;r++)n[r]=Math.round((e[r]??0)/i);return{data:n.buffer,layersQuantized:1,layersSkipped:0}}function Bs(o,t){let e=new Float32Array(o),n=new Uint8Array(e.length),s=1/0,i=-1/0;for(let a=0;a<e.length;a++){let c=e[a]??0;c<s&&(s=c),c>i&&(i=c)}let r=(i-s)/255;for(let a=0;a<e.length;a++)n[a]=Math.round(((e[a]??0)-s)/r);return{data:n.buffer,layersQuantized:1,layersSkipped:0}}function Us(o,t){let e=new Float32Array(o),n=new Uint16Array(e.length);for(let s=0;s<e.length;s++)n[s]=js(e[s]??0);return{data:n.buffer,layersQuantized:1,layersSkipped:0}}function qs(o,t){let e=new Float32Array(o),n=new Uint8Array(Math.ceil(e.length/2)),s=0;for(let r=0;r<e.length;r++){let a=Math.abs(e[r]??0);a>s&&(s=a)}let i=s/7;for(let r=0;r<e.length;r+=2){let a=Math.round((e[r]??0)/i)+8,c=Math.round((e[r+1]??0)/i)+8;n[r/2]=(a&15)<<4|c&15}return{data:n.buffer,layersQuantized:1,layersSkipped:0}}function js(o){let t=new Float32Array(1),e=new Int32Array(t.buffer);t[0]=o;let n=e[0]??0,s=n>>16&32768,i=n>>12&2047,r=n>>23&255;return r<103?s:r>142?(s|=31744,s|=(r===255?0:1)&&n&8388607,s):r<113?(i|=2048,s|=(i>>114-r)+(i>>113-r&1),s):(s|=r-112<<10|i>>1,s+=i&1,s)}async function Ws(o,t){let e=o instanceof ArrayBuffer?o:await Ot(o),n=new Float32Array(e),s=n.length,r=[...n.map(Math.abs)].sort((u,d)=>u-d),a=Math.floor(t.sparsity*r.length),c=r[a]??0,l=0;for(let u=0;u<n.length;u++)Math.abs(n[u]??0)<c&&(n[u]=0,l++);return{modelData:n.buffer,actualSparsity:l/s,parametersPruned:l,totalParameters:s}}async function Hs(o){let t=o instanceof ArrayBuffer?o.byteLength:o.metadata.sizeBytes,e=Math.floor(t/4);return{totalParameters:e,sizeBytes:t,layers:[],estimatedFlops:e*2,memoryRequirements:{weights:t,activations:t*.1,total:t*1.1}}}async function Vs(o,t={}){let{warmupRuns:e=3,runs:n=10}=t;for(let h=0;h<e;h++)await o();let s=[];for(let h=0;h<n;h++){let p=performance.now();await o(),s.push(performance.now()-p)}let r=s.reduce((h,p)=>h+p,0)/s.length,a=Math.min(...s),c=Math.max(...s),u=s.map(h=>Math.pow(h-r,2)).reduce((h,p)=>h+p,0)/s.length,d=Math.sqrt(u);return{avgTime:r,minTime:a,maxTime:c,stdDev:d,throughput:1e3/r,times:s}}async function Gs(o,t){let e=o instanceof ArrayBuffer?o:await Ot(o);switch(t){case"json":let n=new Float32Array(e);return JSON.stringify(Array.from(n));case"binary":case"onnx":default:return e}}async function Oi(){let o=await we();return Array.from(o.values()).some(t=>t)}async function $i(){let o=await we();return o.get("webgpu")?"webgpu":o.get("webnn")?"webnn":o.get("wasm")?"wasm":null}async function Bi(o){let t=new Q;await Promise.all(o.map(async e=>{if(!await t.get(e)){let n=await fetch(e);n.ok&&await t.put(e,n)}}))}var Xs="0.1.0";async function Ui(){let o=await we();return{version:Xs,runtimes:{webgpu:o.get("webgpu")??!1,webnn:o.get("webnn")??!1,wasm:o.get("wasm")??!1,auto:!0},features:["concurrent-execution","batch-processing","memory-management","model-caching","quantization"]}}export{ie as AudioPreprocessor,v as BasePipeline,le as Cache,gn as EMOTION_LABELS,ze as EdgeFlowDebugger,x as EdgeFlowError,g as EdgeFlowTensor,M as ErrorCodes,J as FeatureExtractionPipeline,Be as IMAGENET_LABELS,Y as ImageClassificationPipeline,oe as ImagePreprocessor,$e as InferenceCache,he as InferenceScheduler,B as LoadedModelImpl,ne as MemoryManager,fe as MemoryScope,pe as ModelCache,Q as ModelDownloadCache,zt as POPULAR_MODELS,ve as PerformanceMonitor,$ as RuntimeManager,ke as SENTIMENT_LABELS,K as SentimentAnalysisPipeline,H as TextClassificationPipeline,W as Tokenizer,Xs as VERSION,be as WASMRuntime,xe as WebGPURuntime,Te as WebNNRuntime,Kt as add,Hs as analyzeModel,qn as analyzeModelDetailed,Gt as arange,nn as argmax,Vs as benchmark,Cn as benchmarkMemory,Dn as benchmarkSuite,wt as cancelPreload,mt as clearModelCache,Pn as compareBenchmarks,sn as concat,ls as configureScheduler,Gn as createAsciiHistogram,Mn as createAudioPreprocessor,ue as createBasicTokenizer,fn as createCache,Tn as createFeatureExtractionPipeline,kn as createImageClassificationPipeline,qe as createImagePreprocessor,Ps as createPipelines,xn as createSentimentAnalysisPipeline,Xn as createTensorHeatmap,wn as createTextClassificationPipeline,un as createWASMRuntime,Re as createWebGPURuntime,Oe as createWebNNRuntime,pt as deleteCachedModel,Pt as dequantizeFloat16,et as dequantizeInt8,Bn as dequantizeTensor,Et as dequantizeUint8,Vn as disableDebugging,it as div,He as downloadConfig,Ve as downloadModel,St as downloadTokenizer,Hn as enableDebugging,Gs as exportModel,jn as exportModelAdvanced,Qt as eye,Ft as float16ToFloat32,Ln as formatBenchmarkResult,_n as formatComparisonResult,Wn as formatTensorInspection,Ge as fromHub,Xe as fromTask,Wt as full,ms as gc,Jn as generateAsciiDashboard,Kn as generateDashboardHTML,we as getAvailableRuntimes,As as getBestRuntime,$i as getBestRuntimeType,ft as getCachedModel,Nt as getDebugger,vt as getDefaultModel,Ui as getInfo,R as getMemoryManager,fs as getMemoryStats,gt as getModelCacheStats,En as getModelInfo,Rt as getMonitor,mn as getPipelineFactory,yt as getPreloadStatus,xt as getPreloadedModel,ks as getRuntimeManager,_e as getScheduler,Se as inspectTensor,ge as isModelCached,Oi as isSupported,Xt as linspace,bt as loadModel,V as loadModelData,Mt as loadModelFromBuffer,yn as loadTokenizer,Ue as loadTokenizerFromHub,Zt as matmul,tn as mean,vn as modelExists,Yt as mul,jt as ones,Fn as pipeline,Bi as preload,dt as preloadModel,ht as preloadModels,bn as preprocessText,Ws as prune,Un as pruneModel,_t as pruneTensor,Os as quantize,Lt as quantizeModel,$n as quantizeTensor,Vt as randn,Ht as random,hn as registerAllBackends,U as registerPipeline,ye as registerRuntime,ps as release,De as relu,Ms as runBatchInference,Ie as runBenchmark,re as runInference,on as setScheduler,Le as sigmoid,L as softmax,Yn as startMonitoring,Zn as stopMonitoring,Jt as sub,Fe as sum,en as tanh,qt as tensor,Qn as visualizeModelArchitecture,ds as withMemoryScope,hs as withMemoryScopeSync,ot as zeros};
//# sourceMappingURL=edgeflow.browser.min.js.map
